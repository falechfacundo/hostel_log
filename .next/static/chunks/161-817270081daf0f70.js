"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[161],{1161:function(e,a,s){s.d(a,{NavMenu:function(){return B}});var t=s(7437),r=s(9376),n=s(3145),l=s(7648),i=s(6474),d=s(4449),o=s(5466),c=s(8420),m=s(5805),u=s(2265),x=s(9397),p=s(8250),h=s(7240);function f(e){let{date:a,onChange:s,isLoading:r,className:n}=e,l=a instanceof Date&&!isNaN(a.getTime())?a:new Date,d=(0,p.WU)(l,"yyyy-MM-dd"),[o,c]=(0,u.useState)(d),m=(0,p.WU)(l,"dd/MM/yyyy",{locale:h.es});return(0,u.useEffect)(()=>{a instanceof Date&&!isNaN(a.getTime())&&c((0,p.WU)(a,"yyyy-MM-dd"))},[a]),(0,t.jsxs)("div",{className:(0,i.cn)("flex items-center gap-2",n),children:[(0,t.jsx)("div",{className:"text-sm font-medium flex items-center gap-1",children:(0,t.jsx)("span",{children:"Fecha:"})}),(0,t.jsx)("div",{className:"flex items-center",children:(0,t.jsxs)("div",{className:"relative border focus-within:ring-1 focus-within:ring-primary shadow-sm border-none",children:[(0,t.jsx)("div",{className:"absolute left-4 top-1/2 transform -translate-y-1/2 pointer-events-none z-10 bg-white px-2 py-1",children:m}),(0,t.jsx)("input",{type:"date",value:o,onChange:e=>{let a=e.target.value;c(a),isNaN(new Date(a+"T00:00:00").getTime())||s({target:{value:a}})},className:"px-4 py-2 bg-background focus:outline-none w-[180px] text-transparent select-none"})]})})]})}var g=s(3487),j=s(875),N=s(1817),v=s(8930),y=s(8688),b=s(6557),w=s(522);function D(e){let{onDeletePartner:a,isDeleting:s,partnerToDelete:r}=e,n=(0,w.q)(e=>e.partners),l=(0,w.q)(e=>e.isLoading),i=(0,b.Z)(e=>e.selectedPartner),o=(0,b.Z)(e=>e.setSelectedPartner),c=(0,b.Z)(e=>e.setGroups),m=(0,b.Z)(e=>e.setIndividuals),x=(0,y.t)(e=>e.userProfile),p=l||s;(0,u.useEffect)(()=>{!(n.length>0)||i&&n.some(e=>String(e.id)===String(i.id))||h(n[0])},[i,n]);let h=e=>{(!i||e.id!==i.id)&&(o(e),e.groups&&c(e.groups),e.individuals&&m(e.individuals))};return 0===n.length?(0,t.jsx)("div",{className:"flex-1 max-w-md flex items-center gap-2",children:(0,t.jsxs)("div",{className:"relative flex-1",children:[(0,t.jsx)("select",{className:"w-full py-2 pl-3 pr-10 border rounded-md bg-white appearance-none text-gray-500",disabled:!0,children:(0,t.jsx)("option",{children:"No hay partners disponibles"})}),(0,t.jsx)(j.Z,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 pointer-events-none text-gray-500"})]})}):(0,t.jsxs)("div",{className:"flex-1 max-w-md flex items-center gap-2",children:[(0,t.jsxs)("div",{className:"relative flex-1",children:[(0,t.jsx)("select",{className:"w-full py-2 pl-3 pr-10 border rounded-md bg-white appearance-none",value:(null==i?void 0:i.id)||"",onChange:e=>{let a=e.target.value;if(!a)return;let s=n.find(e=>String(e.id)===String(a));s&&h(s)},disabled:p,children:n.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))}),(0,t.jsx)(j.Z,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 pointer-events-none text-gray-500"})]}),i&&(null==x?void 0:x.role)==="admin"&&(0,t.jsx)(g.u,{content:"Eliminar partner",children:(0,t.jsx)(d.z,{variant:"ghost",size:"icon",onClick:()=>a(i),className:"h-9 w-9 text-red-500 hover:text-red-700 hover:bg-red-50",title:"Eliminar partner",disabled:p,children:s&&(null==r?void 0:r.id)===i.id?(0,t.jsx)(N.Z,{className:"h-4 w-4 animate-spin"}):(0,t.jsx)(v.Z,{className:"h-4 w-4"})})})]})}var Z=s(1723),C=s(1047),z=s(2258);function P(){let e=(0,b.Z)(e=>e.selectedPartner);if(!e)return null;let a=e=>{try{let a=(0,z.D)(e);return(0,p.WU)(a,"dd/MM/yyyy",{locale:h.es})}catch(a){return e}},s=a(e.start_date),r=e.end_date?a(e.end_date):null;return(0,t.jsxs)("div",{className:"flex items-center gap-6 text-sm text-gray-600 ",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(m.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:e.size||0})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(Z.Z,{className:"h-4 w-4"}),(0,t.jsxs)("span",{children:[e.days||5," d\xedas"]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:["Llegada:",(0,t.jsx)(C.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:s})]}),r&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:["Salida:",(0,t.jsx)(C.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:r})]})]})}var k=s(1298),S=s(322),E=s(3032),q=s(4438),F=s(5170);function _(e){let{open:a,onOpenChange:s,creating:r,setCreating:n}=e,l=(0,w.q)(e=>e.createPartner),i=(0,w.q)(e=>e.fetchPartnersByDate),o=(0,b.Z)(e=>e.setSelectedPartner),c=(0,b.Z)(e=>e.setGroups),m=(0,b.Z)(e=>e.setIndividuals),h=(0,F.K)(e=>e.selectedDate),[g,j]=(0,u.useState)({name:"",size:"0",days:"5",startDate:new Date}),v=async()=>{if(!g.name.trim()){q.A.error("El nombre del partner es requerido");return}try{n(!0);let{name:e,size:a,days:t,startDate:r}=g,d=r||new Date;(0,p.WU)(d,"yyyy-MM-dd");let u=parseInt(t)||5,x=await l({name:e,size:parseInt(a)||0,days:u,startDate:d});return await i(h),o(x),c(x.groups||[]),m(x.individuals||[]),j({name:"",size:"0",days:"5",startDate:new Date}),s(!1),!0}catch(e){return q.A.error("Error al crear partner: ".concat(e.message)),!1}finally{n(!1)}};return(0,t.jsx)(k.Vq,{open:a,onOpenChange:s,children:(0,t.jsxs)(k.cZ,{className:"sm:max-w-md",children:[(0,t.jsx)(k.fK,{children:(0,t.jsx)(k.$N,{children:"Crear Nuevo Partner"})}),(0,t.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,t.jsxs)("div",{className:"grid gap-2",children:[(0,t.jsx)(E._,{htmlFor:"partnerName",children:"Nombre del Partner"}),(0,t.jsx)(S.I,{id:"partnerName",value:g.name,onChange:e=>j({...g,name:e.target.value}),placeholder:"Nombre del partner",autoFocus:!0})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"grid gap-2",children:[(0,t.jsx)(E._,{htmlFor:"partnerSize",children:"Cantidad de Integrantes"}),(0,t.jsx)(S.I,{id:"partnerSize",type:"number",min:"0",value:g.size,onChange:e=>j({...g,size:e.target.value}),placeholder:"Cantidad de integrantes"})]}),(0,t.jsxs)("div",{className:"grid gap-2",children:[(0,t.jsx)(E._,{htmlFor:"partnerDays",children:"D\xedas de Estad\xeda"}),(0,t.jsx)(S.I,{id:"partnerDays",type:"number",min:"1",value:g.days,onChange:e=>j({...g,days:e.target.value}),placeholder:"D\xedas de estad\xeda"})]})]}),(0,t.jsxs)("div",{className:"grid gap-2",children:[(0,t.jsxs)(E._,{htmlFor:"partnerStartDate",className:"flex items-center gap-2",children:[(0,t.jsx)(C.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"Fecha de Inicio"})]}),(0,t.jsx)(f,{date:g.startDate,onChange:e=>{try{let a=e.target.value,s=new Date(a);isNaN(s.getTime())||j({...g,startDate:s})}catch(e){console.error("Error setting date:",e)}},className:"w-full"})]})]}),(0,t.jsxs)(k.cN,{children:[(0,t.jsx)(d.z,{variant:"outline",onClick:()=>s(!1),disabled:r,children:"Cancelar"}),(0,t.jsx)(d.z,{onClick:v,disabled:r,children:r?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(N.Z,{className:"h-4 w-4 mr-2 animate-spin"}),"Creando..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(x.Z,{className:"h-4 w-4 mr-2"}),"Crear Partner"]})})]})]})})}var I=s(9322);function T(e){let{open:a,onOpenChange:s,partner:r,deleting:n,setDeleting:l,setPartnerToDelete:i}=e,o=(0,w.q)(e=>e.deletePartner),c=(0,w.q)(e=>e.fetchPartnersByDate),m=(0,w.q)(e=>e.partners),u=(0,b.Z)(e=>e.selectedPartner),x=(0,b.Z)(e=>e.setSelectedPartner),p=(0,b.Z)(e=>e.setGroups),h=(0,b.Z)(e=>e.setIndividuals),f=(0,F.K)(e=>e.selectedDate),g=async()=>{if(null==r?void 0:r.id)try{l(!0);let e=r.id,a=m.filter(a=>a.id!==e),t=a.length>0?a[0]:null;await o(e),await c(f),(null==u?void 0:u.id)===e&&(t?(x(t),t.groups&&p(t.groups),t.individuals&&h(t.individuals)):(x(null),p([]),h([]))),s(!1),i(null)}catch(e){console.log("Error deleting partner:",e)}finally{l(!1)}};return(0,t.jsx)(k.Vq,{open:a,onOpenChange:e=>{n||s(e)},children:(0,t.jsxs)(k.cZ,{className:"sm:max-w-md",children:[(0,t.jsxs)(k.fK,{children:[(0,t.jsxs)(k.$N,{className:"flex items-center gap-2 text-red-600",children:[(0,t.jsx)(I.Z,{className:"h-5 w-5"}),"Eliminar Partner"]}),(0,t.jsxs)(k.Be,{children:['\xbfEst\xe1s seguro que deseas eliminar el partner "',null==r?void 0:r.name,'"? Esta acci\xf3n no se puede deshacer.']})]}),(0,t.jsxs)("div",{className:"py-4",children:[(0,t.jsx)("p",{className:"text-sm text-red-500 font-medium",children:"\xa1Advertencia! Se eliminar\xe1n todos los datos asociados a este partner:"}),(0,t.jsxs)("ul",{className:"list-disc list-inside text-sm text-gray-500 mt-2 space-y-1",children:[(0,t.jsx)("li",{children:"Todos los grupos asignados a este partner"}),(0,t.jsx)("li",{children:"Todas las personas individuales vinculadas"}),(0,t.jsx)("li",{children:"Todas las asignaciones de albergues"})]})]}),(0,t.jsxs)(k.cN,{className:"gap-2 sm:gap-0",children:[(0,t.jsx)(d.z,{variant:"outline",onClick:()=>s(!1),disabled:n,children:"Cancelar"}),(0,t.jsx)(d.z,{variant:"destructive",onClick:g,disabled:n,children:n?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(N.Z,{className:"h-4 w-4 mr-2 animate-spin"}),"Eliminando..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(v.Z,{className:"h-4 w-4 mr-2"}),"Eliminar Partner"]})})]})]})})}let M=null;function V(){let[e,a]=(0,u.useState)(!1),[s,r]=(0,u.useState)(!1),[n,l]=(0,u.useState)(!1),[i,o]=(0,u.useState)(!1),[c,m]=(0,u.useState)(null),p=(0,y.t)(e=>e.userProfile),h=(0,y.t)(e=>e.isAuthenticated),g=(0,b.Z)(e=>e.selectedPartner),j=(0,F.K)(e=>e.selectedDate),N=(0,F.K)(e=>e.setSelectedDate);(0,w.q)(e=>e.partners);let v=(0,w.q)(e=>e.fetchPartnersByDate);(0,u.useEffect)(()=>{(null==g?void 0:g.id)&&g.id!==M&&(M=g.id)},[null==g?void 0:g.id]),(0,u.useEffect)(()=>{j&&v(j)},[j,v]);let Z=(0,u.useCallback)(e=>{let a=new Date(e.target.value+"T00:00:00");isNaN(a.getTime())||N(a)},[N]),C=(0,u.useCallback)(e=>{m(e),r(!0)},[]);return h?(0,t.jsxs)("div",{className:"flex items-center justify-between py-2 px-4 bg-white border-b",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(D,{onDeletePartner:C,isDeleting:i,partnerToDelete:c}),(null==p?void 0:p.role)==="admin"&&(0,t.jsx)(d.z,{onClick:()=>a(!0),variant:"ghost",size:"sm",className:"ml-2",disabled:n||i,children:(0,t.jsx)(x.Z,{className:"h-4 w-4 mr-1"})})]}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsx)(P,{})}),(null==p?void 0:p.role)==="admin"&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(_,{open:e,onOpenChange:a,creating:n,setCreating:l}),(0,t.jsx)(T,{open:s,onOpenChange:r,partner:c,deleting:i,setDeleting:o,setPartnerToDelete:m})]}),(0,t.jsx)(f,{date:j,onChange:Z})]}):null}var R=s(7692);function A(e){let{variant:a="outline",size:s="sm"}=e,[n,l]=(0,u.useState)(!1),{signOut:i}=(0,y.t)(),o=(0,r.useRouter)(),c=async()=>{try{l(!0),await i(),o.push("/login")}catch(e){console.error("Logout error:",e),q.A.error("Error al cerrar sesi\xf3n. Int\xe9ntelo de nuevo.")}finally{l(!1)}};return(0,t.jsx)(d.z,{variant:a,size:s,onClick:c,disabled:n,children:n?(0,t.jsx)("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-current border-t-transparent"}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(R.Z,{className:"h-4 w-4 mr-2"}),(0,t.jsx)("span",{children:"Cerrar sesi\xf3n"})]})})}let K=[{name:"Dashboard",href:"/",icon:o.Z,roles:["editor","admin"]},{name:"Albergues",href:"/albergues",icon:c.Z,roles:["admin"]},{name:"Viajeros",href:"/viajeros",icon:m.Z,roles:["admin"]}];function B(){let e=(0,y.t)(e=>e.isAuthenticated),a=(0,y.t)(e=>e.userProfile),s=(0,r.usePathname)();return(0,t.jsxs)("header",{children:[(0,t.jsxs)("nav",{className:"flex justify-between items-center px-8 py-4 bg-white/50 backdrop-blur-sm border-b",children:[(0,t.jsx)("div",{className:"flex items-center gap-8",children:(0,t.jsx)("div",{className:"flex space-x-4",children:e&&K.map(e=>{let r=e.icon;return(null==a?void 0:a.role)&&e.roles.includes(a.role)?(0,t.jsxs)(l.default,{href:e.href,className:(0,i.cn)("flex items-center space-x-2 px-4 py-2 rounded-lg transition-colors",s===e.href?"bg-fuchsia-pink-500 text-white":"hover:bg-fuchsia-pink-100"),children:[(0,t.jsx)(r,{className:"h-5 w-5"}),(0,t.jsx)("span",{children:e.name})]},e.name):null})})}),(0,t.jsxs)("div",{className:"flex items-center gap-8",children:[e&&(0,t.jsx)(A,{variant:"ghost",size:"md"}),(0,t.jsx)(l.default,{href:"/login",className:"flex items-center gap-2",children:(0,t.jsx)(n.default,{src:"/logo.png",alt:"Logo",width:60,height:60,className:"object-contain w-auto"})})]})]}),(0,t.jsx)(V,{})]})}},1298:function(e,a,s){s.d(a,{$N:function(){return h},Be:function(){return f},Vq:function(){return d},cN:function(){return p},cZ:function(){return u},fK:function(){return x},hg:function(){return o}});var t=s(7437),r=s(2265),n=s(9027),l=s(2489),i=s(6474);let d=n.fC,o=n.xz,c=n.h_;n.x8;let m=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(n.aV,{ref:a,className:(0,i.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...r})});m.displayName=n.aV.displayName;let u=r.forwardRef((e,a)=>{let{className:s,children:r,...d}=e;return(0,t.jsxs)(c,{children:[(0,t.jsx)(m,{}),(0,t.jsxs)(n.VY,{ref:a,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...d,children:[r,(0,t.jsxs)(n.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,t.jsx)(l.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Cerrar"})]})]})]})});u.displayName=n.VY.displayName;let x=e=>{let{className:a,...s}=e;return(0,t.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-left",a),...s})};x.displayName="DialogHeader";let p=e=>{let{className:a,...s}=e;return(0,t.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...s})};p.displayName="DialogFooter";let h=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(n.Dx,{ref:a,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",s),...r})});h.displayName=n.Dx.displayName;let f=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(n.dk,{ref:a,className:(0,i.cn)("text-sm text-muted-foreground",s),...r})});f.displayName=n.dk.displayName},322:function(e,a,s){s.d(a,{I:function(){return l}});var t=s(7437),r=s(2265),n=s(6474);let l=r.forwardRef((e,a)=>{let{className:s,type:r,...l}=e;return(0,t.jsx)("input",{type:r,className:(0,n.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:a,...l})});l.displayName="Input"},3032:function(e,a,s){s.d(a,{_:function(){return o}});var t=s(7437),r=s(2265),n=s(6394),l=s(535),i=s(6474);let d=(0,l.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),o=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(n.f,{ref:a,className:(0,i.cn)(d(),s),...r})});o.displayName=n.f.displayName},3487:function(e,a,s){s.d(a,{TooltipProvider:function(){return i},u:function(){return u}});var t=s(7437),r=s(2265),n=s(1312),l=s(6474);let i=n.zt,d=n.fC,o=n.xz,c=n.h_,m=r.forwardRef((e,a)=>{let{className:s,sideOffset:r=4,...i}=e;return(0,t.jsx)(n.VY,{ref:a,sideOffset:r,className:(0,l.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...i})});m.displayName=n.VY.displayName;let u=e=>{let{children:a,content:s,className:r,delayDuration:n=300,...l}=e;return(0,t.jsxs)(d,{delayDuration:n,children:[(0,t.jsx)(o,{asChild:!0,children:a}),(0,t.jsx)(c,{children:(0,t.jsx)(m,{className:r,...l,children:s})})]})}}}]);