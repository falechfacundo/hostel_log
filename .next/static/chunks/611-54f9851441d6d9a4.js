"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[611],{4449:function(r,e,t){t.d(e,{z:function(){return d}});var n=t(7437),o=t(2265),a=t(7495),i=t(535),s=t(6474);let l=(0,i.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"bg-transparent hover:bg-accent hover:text-accent-foreground transition-colors",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-8 w-8 p-0 flex items-center justify-center"}},defaultVariants:{variant:"default",size:"default"}}),d=o.forwardRef((r,e)=>{let{className:t,variant:o,size:i,asChild:d=!1,...u}=r,c=d?a.g7:"button";return(0,n.jsx)(c,{className:(0,s.cn)(l({variant:o,size:i,className:t})),ref:e,...u})});d.displayName="Button"},877:function(r,e,t){t.d(e,{O:function(){return n}});let n=(0,t(3777).eI)("https://llwgjoxjuvqmtmlvlqpr.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imxsd2dqb3hqdXZxbXRtbHZscXByIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDA2NzYyOTEsImV4cCI6MjA1NjI1MjI5MX0.0bl222cpSXfbN6v_08NyKQohDta19N4xwdY2s_l628A",{auth:{persistSession:!0,storageKey:"supabase-auth",storage:{getItem:r=>{try{let e=localStorage.getItem(r);return e?JSON.parse(e):null}catch(r){return console.error("Error accessing localStorage:",r),null}},setItem:(r,e)=>{try{localStorage.setItem(r,JSON.stringify(e))}catch(r){console.error("Error writing to localStorage:",r)}},removeItem:r=>{try{localStorage.removeItem(r)}catch(r){console.error("Error removing from localStorage:",r)}}}}})},6474:function(r,e,t){t.d(e,{cn:function(){return a}});var n=t(1994),o=t(3335);function a(){for(var r=arguments.length,e=Array(r),t=0;t<r;t++)e[t]=arguments[t];return(0,o.m6)((0,n.W)(e))}},8688:function(r,e,t){t.d(e,{t:function(){return l}});var n=t(3011),o=t(877),a=t(6885),i=t(4438);let s=async r=>{if(!r)return null;let{data:e,error:t}=await o.O.from("profiles").select("*").eq("id",r).single();return t?(console.error("Error fetching user profile:",t),null):e},l=(0,n.U)((0,a.tJ)((r,e)=>({user:null,userProfile:null,loading:!0,isAuthenticated:!1,authSubscription:null,init:async()=>{try{r({loading:!0});let t=e().authSubscription;t&&t.unsubscribe();let{data:{session:n},error:a}=await o.O.auth.getSession();if(a)return console.error("Session retrieval error:",a),r({loading:!1,isAuthenticated:!1}),null;let l=null;(null==n?void 0:n.user)&&(l=await s(n.user.id)),r({user:(null==n?void 0:n.user)||null,userProfile:l,isAuthenticated:!!(null==n?void 0:n.user),loading:!1});let{data:{subscription:d}}=o.O.auth.onAuthStateChange(async(e,t)=>{console.log("Auth state change:",e,t?"session exists":"no session");let n=null;(null==t?void 0:t.user)&&(n=await s(t.user.id)),r({user:(null==t?void 0:t.user)||null,userProfile:n,isAuthenticated:!!(null==t?void 0:t.user)}),"SIGNED_IN"===e?i.A.success("Sesi\xf3n iniciada correctamente"):"SIGNED_OUT"===e?i.A.info("Sesi\xf3n cerrada"):"TOKEN_REFRESHED"===e&&console.log("Token refreshed successfully")});return r({authSubscription:d}),d}catch(e){return console.error("Auth initialization error:",e),r({loading:!1,user:null,userProfile:null,isAuthenticated:!1}),null}},refreshSession:async()=>{try{r({loading:!0});let{data:e,error:t}=await o.O.auth.refreshSession();if(t)throw t;let{session:n,user:a}=e,i=null;return a&&(i=await s(a.id)),r({user:a||null,userProfile:i,isAuthenticated:!!a,loading:!1}),{session:n,user:a}}catch(e){throw r({loading:!1}),console.error("Session refresh error:",e),e}},signIn:async e=>{let{email:t,password:n}=e;try{r({loading:!0});let{data:e,error:a}=await o.O.auth.signInWithPassword({email:t,password:n});if(a)throw a;let i=await s(e.user.id);return r({user:e.user,userProfile:i,isAuthenticated:!!e.user,loading:!1}),{user:e.user,profile:i}}catch(e){throw r({loading:!1}),i.A.error("Error: ".concat(e.message)),e}},signUp:async e=>{let{email:t,password:n,userData:a={}}=e;try{var l;r({loading:!0});let{data:e,error:i}=await o.O.auth.signUp({email:t,password:n,options:{data:{...a}}});if(i)throw i;if(e.user&&(null===(l=e.user.identities)||void 0===l?void 0:l.length)===0)return r({loading:!1}),{user:null,requiresEmailConfirmation:!0};let d=await s(e.user.id);return r({user:e.user,userProfile:d,isAuthenticated:!!e.user,loading:!1}),{user:e.user,profile:d,requiresEmailConfirmation:!1}}catch(e){throw r({loading:!1}),i.A.error("Error: ".concat(e.message)),e}},signOut:async()=>{try{r({loading:!0});let{error:e}=await o.O.auth.signOut();if(e)throw e;return r({user:null,userProfile:null,isAuthenticated:!1,loading:!1}),!0}catch(e){throw r({loading:!1}),i.A.error("Error al cerrar sesi\xf3n: ".concat(e.message)),e}}}),{name:"auth-storage",partialize:r=>({user:r.user,userProfile:r.userProfile}),onRehydrateStorage:()=>r=>{r&&r.init()}}))},5170:function(r,e,t){t.d(e,{K:function(){return i}});var n=t(3011),o=t(8250),a=t(6885);let i=(0,n.U)((0,a.tJ)(r=>({selectedDate:new Date,dateStr:(0,o.WU)(new Date,"yyyy-MM-dd"),setSelectedDate:e=>{let t=new Date(e);r({selectedDate:t,dateStr:(0,o.WU)(t,"yyyy-MM-dd")})}}),{name:"selected-date-storage",getStorage:()=>localStorage,partialize:r=>({selectedDate:r.selectedDate.toISOString(),dateStr:r.dateStr}),onRehydrateStorage:()=>r=>{if(r&&r.selectedDate){let e=new Date(r.selectedDate);r.selectedDate=e,r.dateStr=(0,o.WU)(e,"yyyy-MM-dd")}}}))},6557:function(r,e,t){t.d(e,{Z:function(){return a}});var n=t(3011);t(4438);var o=t(6885);let a=(0,n.U)((0,o.tJ)((r,e)=>({selectedPartner:null,groups:[],individuals:[],hostelAssignments:[],setSelectedPartner:e=>{if(!e){r({selectedPartner:null,groups:[],individuals:[]});return}r({selectedPartner:e,groups:e.groups||[],individuals:e.individuals||[]}),window.dispatchEvent(new CustomEvent("partner-changed",{detail:{partner:e}}))},setGroups:e=>r({groups:e}),setIndividuals:e=>r({individuals:e}),setHostelAssignments:e=>r({hostelAssignments:e})}),{name:"partner-storage",getStorage:()=>localStorage,partialize:r=>({selectedPartner:r.selectedPartner,groups:r.groups,individuals:r.individuals,hostelAssignments:r.hostelAssignments}),onRehydrateStorage:()=>r=>{r&&(console.log("Partner store rehydrated from storage"),r.selectedPartner&&window.dispatchEvent(new CustomEvent("partner-changed",{detail:{partner:r.selectedPartner}})))}}))},522:function(r,e,t){t.d(e,{q:function(){return g}});var n=t(3011),o=t(877),a=t(4438),i=t(8250),s=t(8700),l=t(6557);t(3079);var d=t(2119),u=(0,d.$)("dc989150d3e40f12b62d32b1d4696ce7e25131ba"),c=(0,d.$)("dbf92610f26438a90ecfd4062645c3ead5ee2e29"),p=(0,d.$)("721ba0f507080d5e5d2fa0817fe34b2e284f36f7");let g=(0,n.U)((r,e)=>({partners:[],groups:[],individuals:[],isLoading:!1,error:null,lastRequestDate:null,fetchPartnersByDate:async e=>{try{r({isLoading:!0,error:null,lastRequestDate:e});let t=(0,i.WU)(new Date(e),"yyyy-MM-dd");console.log("ZUSTAND: Fetching partners by date via Server Action");let n=await c(t);if(n.error)throw Error(n.error);let{partners:o,groups:a,individuals:s}=n;if(!(null==o?void 0:o.length))return r({partners:[],groups:[],individuals:[],isLoading:!1}),[];r({partners:o,groups:a||[],individuals:s||[],isLoading:!1});let d=l.Z.getState(),u=d.selectedPartner;if(null==u?void 0:u.id){let r=o.find(r=>r.id===u.id);r&&d.setSelectedPartner(r)}return o}catch(e){throw console.error("Error fetching partners:",e),r({error:e.message,isLoading:!1}),a.A.error("Error al cargar partners: ".concat(e.message)),e}},cancelRequests:()=>{r({isLoading:!1})},fetchGroups:async r=>{if(!r)return console.log("No partner ID provided for fetching groups, returning empty array"),[];let e="object"==typeof r&&null!==r?r.id||null:r;if(!e)return console.log("Invalid partner ID, returning empty array"),[];try{let r=o.O.from("groups").select("\n            *,\n            person(*)\n          ").eq("partner_id",e),{data:t,error:n}=await r;if(n)throw Error("Error fetching groups: ".concat(n.message));return t.map(r=>({...r,people:r.person||[]}))}catch(r){return console.error("Error in fetchGroups:",r),[]}},fetchIndividuals:async r=>{if(!r)return console.log("No partner ID provided for fetching individuals, returning empty array"),[];let e="object"==typeof r&&null!==r?r.id||null:r;if(!e)return console.log("Invalid partner ID, returning empty array"),[];try{let r=o.O.from("person").select("*").is("group_id",null).eq("partner_id",e).order("name"),{data:t,error:n}=await r;if(n)throw Error("Error fetching individuals: ".concat(n.message));return t||[]}catch(r){return console.error("Error in fetchIndividuals:",r),[]}},fetchHostelAssignments:async r=>{if(!r)return console.log("No partner ID provided for fetching hostel assignments, returning empty array"),[];let e="object"==typeof r&&null!==r?r.id||null:r;if(!e)return console.log("Invalid partner ID for hostel assignments, returning empty array"),[];try{let{data:r,error:t}=await o.O.from("hostel_partner_assignments").select("\n            *,\n            hostel:hostels(*)\n          ").eq("partner_id",e);if(t)throw Error("Error fetching hostel assignments: ".concat(t.message));return r||[]}catch(r){return console.error("Error in fetchHostelAssignments:",r),[]}},createGroup:async t=>{try{var n,i;r({isLoading:!0,error:null});let{partnerId:s}=t,{data:d,error:u}=await o.O.from("groups").insert([{size:(null===(n=t.people)||void 0===n?void 0:n.length)||0,partner_id:s}]).select().single();if(u)throw Error("Error creating group: ".concat(u.message));let c=[];if(t.people&&t.people.length>0){let r=t.people.map(r=>({name:r.name,backpack:r.backpack||!1,group_id:d.id,partner_id:s})),{data:e,error:n}=await o.O.from("person").insert(r).select();if(n)throw Error("Error creating people: ".concat(n.message));c=e||[]}let p={...d,people:c};r(r=>{let e=[...r.groups,p],t=r.partners.map(r=>r.id===s?{...r,groups:[...r.groups||[],p]}:r);return{groups:e,partners:t,isLoading:!1}});let g=l.Z.getState();return(null===(i=g.selectedPartner)||void 0===i?void 0:i.id)===s&&g.setGroups([...e().groups]),a.A.success("Grupo creado correctamente"),p}catch(e){throw console.error("Error in createGroup:",e),r({error:e.message,isLoading:!1}),a.A.error("Error al crear grupo: ".concat(e.message)),e}},deleteGroup:async t=>{try{var n;r({isLoading:!0,error:null});let i=e().groups.find(r=>r.id===t);if(!i)throw Error("Group not found");let{error:s}=await o.O.from("groups").delete().eq("id",t);if(s)throw Error("Error deleting group: ".concat(s.message));r(r=>{let e=r.groups.filter(r=>r.id!==t),n=r.partners.map(r=>r.id===i.partner_id?{...r,groups:(r.groups||[]).filter(r=>r.id!==t)}:r);return{groups:e,partners:n,isLoading:!1}});let d=l.Z.getState();return(null===(n=d.selectedPartner)||void 0===n?void 0:n.id)===i.partner_id&&d.setGroups(e().groups.filter(r=>r.id!==t)),a.A.success("Grupo eliminado correctamente"),i}catch(e){throw console.error("Error in deleteGroup:",e),r({error:e.message,isLoading:!1}),a.A.error("Error al eliminar grupo: ".concat(e.message)),e}},createIndividual:async t=>{try{var n;r({isLoading:!0,error:null});let{data:i,error:s}=await o.O.from("person").insert([{name:t.name,backpack:t.backpack||!1,partner_id:t.partnerId}]).select().single();if(s)throw Error("Error creating individual: ".concat(s.message));r(r=>{let e=[...r.individuals,i],n=r.partners.map(r=>r.id===t.partnerId?{...r,individuals:[...r.individuals||[],i]}:r);return{individuals:e,partners:n,isLoading:!1}});let d=l.Z.getState();return(null===(n=d.selectedPartner)||void 0===n?void 0:n.id)===t.partnerId&&d.setIndividuals([...e().individuals]),a.A.success("Persona creada correctamente"),i}catch(e){throw console.error("Error in createIndividual:",e),r({error:e.message,isLoading:!1}),a.A.error("Error al crear persona: ".concat(e.message)),e}},deleteIndividual:async t=>{try{var n;r({isLoading:!0,error:null});let i=e().individuals.find(r=>r.id===t);if(!i)throw Error("Individual not found");let{error:s}=await o.O.from("person").delete().eq("id",t);if(s)throw Error("Error deleting individual: ".concat(s.message));r(r=>{let e=r.individuals.filter(r=>r.id!==t),n=r.partners.map(r=>r.id===i.partner_id?{...r,individuals:(r.individuals||[]).filter(r=>r.id!==t)}:r);return{individuals:e,partners:n,isLoading:!1}});let d=l.Z.getState();return(null===(n=d.selectedPartner)||void 0===n?void 0:n.id)===i.partner_id&&d.setIndividuals(e().individuals.filter(r=>r.id!==t)),a.A.success("Persona eliminada correctamente"),{id:t}}catch(e){throw console.error("Error in deleteIndividual:",e),r({error:e.message,isLoading:!1}),a.A.error("Error al eliminar persona: ".concat(e.message)),e}},addPersonToGroup:async t=>{let{groupId:n,personData:i}=t;try{var s;r({isLoading:!0,error:null});let t=e().groups.find(r=>r.id===n);if(!t)throw Error("Group not found");let a=i.partnerId||t.partner_id,{data:d,error:u}=await o.O.from("person").insert([{name:i.name,backpack:i.backpack||!1,group_id:n,partner_id:a}]).select().single();if(u)throw Error("Error adding person to group: ".concat(u.message));let c=(t.size||0)+1;await o.O.from("groups").update({size:c}).eq("id",n),r(r=>{let e=r.groups.map(r=>r.id===n?{...r,size:c,people:[...r.people||[],d]}:r),t=r.partners.map(r=>r.id===a?{...r,groups:(r.groups||[]).map(r=>r.id===n?{...r,size:c,people:[...r.people||[],d]}:r)}:r);return{groups:e,partners:t,isLoading:!1}});let p=l.Z.getState();return(null===(s=p.selectedPartner)||void 0===s?void 0:s.id)===a&&p.setGroups([...e().groups]),{newPerson:d,groupId:n,newGroupSize:c}}catch(e){throw console.error("Error in addPersonToGroup:",e),r({error:e.message,isLoading:!1}),a.A.error("Error al a\xf1adir persona al grupo: ".concat(e.message)),e}},removePersonFromGroup:async t=>{let{groupId:n,personId:i}=t;try{var s;r({isLoading:!0,error:null});let t=e().groups.find(r=>r.id===n);if(!t)throw Error("Group not found");let{error:a}=await o.O.from("person").delete().eq("id",i);if(a)throw Error("Error removing person: ".concat(a.message));let d=Math.max(0,(t.size||1)-1),{error:u}=await o.O.from("groups").update({size:d}).eq("id",n);if(u)throw Error("Error updating group size: ".concat(u.message));r(r=>{let e=r.groups.map(r=>r.id===n?{...r,size:d,people:(r.people||[]).filter(r=>r.id!==i)}:r),t=r.partners.map(r=>(r.groups||[]).find(r=>r.id===n)?{...r,groups:r.groups.map(r=>r.id===n?{...r,size:d,people:(r.people||[]).filter(r=>r.id!==i)}:r)}:r);return{groups:e,partners:t,isLoading:!1}});let c=l.Z.getState(),p=t.partner_id;return(null===(s=c.selectedPartner)||void 0===s?void 0:s.id)===p&&c.setGroups([...e().groups]),{groupId:n,newGroupSize:d}}catch(e){throw console.error("Error in removePersonFromGroup:",e),r({error:e.message,isLoading:!1}),a.A.error("Error al eliminar persona del grupo: ".concat(e.message)),e}},updatePerson:async t=>{try{r({isLoading:!0,error:null});let{id:n,...a}=t,{data:i,error:s}=await o.O.from("person").update({...a,updated_at:new Date}).eq("id",n).select().single();if(s)throw Error("Error updating person: ".concat(s.message));r(e=>{if(e.individuals.some(r=>r.id===n)){let r=e.individuals.map(r=>r.id===n?{...r,...a}:r),t=e.partners.map(r=>(r.individuals||[]).find(r=>r.id===n)?{...r,individuals:r.individuals.map(r=>r.id===n?{...r,...a}:r)}:r);return{individuals:r,partners:t,isLoading:!1}}{let t=null,o=null;if(e.groups.forEach(r=>{(r.people||[]).find(r=>r.id===n)&&(t=r.id,o=r.partner_id)}),!t)return r({isLoading:!1}),e;let i=e.groups.map(r=>r.id===t?{...r,people:(r.people||[]).map(r=>r.id===n?{...r,...a}:r)}:r),s=e.partners.map(r=>r.id===o?{...r,groups:(r.groups||[]).map(r=>r.id===t?{...r,people:(r.people||[]).map(r=>r.id===n?{...r,...a}:r)}:r)}:r);return{groups:i,partners:s,isLoading:!1}}});let d=l.Z.getState();return e().individuals.some(r=>r.id===n)?d.setIndividuals([...e().individuals]):d.setGroups([...e().groups]),i}catch(e){throw console.error("Error in updatePerson:",e),r({error:e.message,isLoading:!1}),a.A.error("Error al actualizar persona: ".concat(e.message)),e}},createPartner:async e=>{try{r({isLoading:!0,error:null});let{name:t,size:n,days:o,startDate:d}=e,u=d||new Date,c=(0,i.WU)(u,"yyyy-MM-dd"),g=parseInt(o)||5,f=(0,s.E)(u,g),m=(0,i.WU)(f,"yyyy-MM-dd"),h={name:t,size:parseInt(n)||0,days:g,start_date:c,end_date:m},v=await p(h);if(v.error)throw Error(v.error);r(r=>({partners:[...r.partners,v],isLoading:!1}));let y=l.Z.getState();return y.setSelectedPartner(v),y.setGroups([]),y.setIndividuals([]),a.A.success('Partner "'.concat(v.name,'" creado correctamente')),v}catch(e){throw console.error("Error creating partner:",e),r({error:e.message,isLoading:!1}),a.A.error("Error al crear partner: ".concat(e.message)),e}},deletePartner:async t=>{try{var n;r({isLoading:!0,error:null});let o=e().partners.find(r=>r.id===t);if(!o)throw Error("Partner not found");let i=await u(t);if(i.error)throw Error(i.error);r(r=>({partners:r.partners.filter(r=>r.id!==t),isLoading:!1}));let s=l.Z.getState();if((null===(n=s.selectedPartner)||void 0===n?void 0:n.id)===t){let r=e().partners.length>0?e().partners[0]:null;r?(s.setSelectedPartner(r),r.groups&&s.setGroups(r.groups),r.individuals&&s.setIndividuals(r.individuals)):(s.setSelectedPartner(null),s.setGroups([]),s.setIndividuals([]))}return a.A.success('Partner "'.concat(o.name,'" eliminado correctamente')),{id:t}}catch(e){throw console.error("Error deleting partner:",e),r({error:e.message,isLoading:!1}),a.A.error("Error al eliminar partner: ".concat(e.message)),e}},getPartnerById:r=>e().partners.find(e=>e.id===r)||null,resetError:()=>r({error:null}),getGroupsByPartnerId:r=>r?e().groups.filter(e=>e.partner_id===r):[],getIndividualsByPartnerId:r=>r?e().individuals.filter(e=>e.partner_id===r):[]}))}}]);