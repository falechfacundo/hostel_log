(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[226],{7584:function(e,r,s){Promise.resolve().then(s.bind(s,5007))},5007:function(e,r,s){"use strict";s.r(r),s.d(r,{default:function(){return B}});var t=s(7437),a=s(9507),n=s(2265),i=s(5170),o=s(3583),l=s(4449),c=s(9397),d=s(3245),u=s(44),m=s(9279),g=s(3011),h=s(877),f=s(4438);let p=(0,g.U)((e,r)=>({rooms:{},isLoading:!1,error:null,fetchRoomsByHostel:async r=>{if(!r)return[];try{e(e=>({isLoading:!0,error:null,rooms:{...e.rooms}}));let{data:s,error:t}=await h.O.from("rooms").select("*").eq("hostel_id",r);if(t)throw Error("Error fetching rooms: ".concat(t.message));return e(e=>({rooms:{...e.rooms,[r]:s||[]},isLoading:!1})),s||[]}catch(r){throw console.error("Error in fetchRoomsByHostel:",r),e({error:r.message,isLoading:!1}),r}},addRoom:async(s,t,a)=>{try{if((r().rooms[s]||[]).reduce((e,r)=>e+(r.capacity||0),0)+t.capacity>a)throw Error("La capacidad total de las habitaciones exceder\xeda el l\xedmite del albergue (".concat(a," personas)"));e({isLoading:!0,error:null});let{data:n,error:i}=await h.O.from("rooms").insert([{...t,hostel_id:s}]).select().single();if(i)throw Error("Error creating room: ".concat(i.message));return e(e=>{let r=e.rooms[s]||[];return{rooms:{...e.rooms,[s]:[...r,n]},isLoading:!1}}),n}catch(r){throw console.error("Error in addRoom:",r),e({error:r.message,isLoading:!1}),f.A.error("Error al crear habitaci\xf3n: ".concat(r.message)),r}},updateRoom:async(r,s)=>{try{e({isLoading:!0,error:null});let{data:t,error:a}=await h.O.from("rooms").update(s).eq("id",r).select().single();if(a)throw Error("Error updating room: ".concat(a.message));return e(e=>{let s=t.hostel_id,a=e.rooms[s]||[];return{rooms:{...e.rooms,[s]:a.map(e=>e.id===r?t:e)},isLoading:!1}}),t}catch(r){throw console.error("Error in updateRoom:",r),e({error:r.message,isLoading:!1}),f.A.error("Error al actualizar habitaci\xf3n: ".concat(r.message)),r}},deleteRoom:async(r,s)=>{try{e({isLoading:!0,error:null});let{error:t}=await h.O.from("rooms").delete().eq("id",s);if(t)throw Error("Error deleting room: ".concat(t.message));return e(e=>{let t=e.rooms[r]||[];return{rooms:{...e.rooms,[r]:t.filter(e=>e.id!==s)},isLoading:!1}}),{id:s}}catch(r){throw console.error("Error in deleteRoom:",r),e({error:r.message,isLoading:!1}),f.A.error("Error al eliminar habitaci\xf3n: ".concat(r.message)),r}},getRoomsByHostel:e=>r().rooms[e]||[],resetError:()=>e({error:null})}));var x=s(1128),y=s(8930);function v(e){let{rooms:r=[],onDeleteRoom:s}=e;return r.length?(0,t.jsx)("div",{className:"flex flex-wrap gap-4",children:r.map(e=>(0,t.jsxs)("div",{className:"flex items-center gap-8 bg-gray-50 p-2 rounded w-full justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(x.Z,{className:"h-4 w-4 mr-2 text-gray-500"}),(0,t.jsx)("span",{children:e.name})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsxs)("span",{className:"text-sm text-gray-600",children:[e.capacity," personas"]}),(0,t.jsx)(l.z,{variant:"ghost",size:"icon",onClick:()=>{s(e.id)},children:(0,t.jsx)(y.Z,{className:"h-4 w-4 text-red-500"})})]})]},e.id))}):(0,t.jsx)("div",{className:"text-center text-gray-500 py-4",children:"No hay habitaciones creadas"})}var b=s(322);function w(e){let{onAddRoom:r}=e,[s,a]=(0,n.useState)({name:"",capacity:""});return(0,t.jsxs)("div",{className:"flex gap-2 mt-4",children:[(0,t.jsx)(b.I,{placeholder:"Capacidad",type:"number",value:s.capacity,onChange:e=>a({...s,capacity:e.target.value}),className:"w-24"}),(0,t.jsx)(l.z,{onClick:()=>{if(!s.capacity){f.A.error("Por favor complete todos los campos");return}r({capacity:parseInt(s.capacity)}),a({name:"",capacity:""})},variant:"outline",children:(0,t.jsx)(c.Z,{className:"h-4 w-4"})})]})}var j=s(5675);function N(e){let{hostel:r,onDelete:s}=e;return(0,t.jsxs)("div",{className:"flex justify-between items-start mb-6",children:[(0,t.jsx)("div",{className:"flex gap-8 items-center",children:(0,t.jsx)("h3",{className:"text-xl font-semibold leading-6 p-0",children:r.name})}),(0,t.jsxs)("div",{className:"flex space-x-2",children:[(0,t.jsx)(l.z,{variant:"ghost",size:"icon",children:(0,t.jsx)(j.Z,{className:"h-4 w-4"})}),(0,t.jsx)(l.z,{variant:"ghost",size:"icon",onClick:()=>s(r.id),children:(0,t.jsx)(y.Z,{className:"h-4 w-4 text-red-500"})})]})]})}function A(e){let{hostel:r,activeHostelId:s,setActiveHostelId:a,date:i,assignments:d=[]}=e,{deleteHostel:u}=(0,m._)(),{getRoomsByHostel:g,fetchRoomsByHostel:h,addRoom:f,deleteRoom:x}=p();(0,n.useEffect)(()=>{(null==r?void 0:r.id)&&h(r.id)},[null==r?void 0:r.id,h]);let y=g(r.id)||[],b=y.reduce((e,r)=>e+(r.capacity||0),0),j=r.capacity-b;return(0,t.jsxs)(o.Zb,{className:"p-6",children:[(0,t.jsx)(N,{hostel:r,onDelete:u}),(0,t.jsxs)("div",{className:"flex flex-col justify-between",children:[(0,t.jsxs)("div",{className:"justify-start space-y-2",children:[(0,t.jsx)("h4",{className:"font-medium",children:"Habitaciones"}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Capacidad: ",b,"/",r.capacity," (",j," ","disponibles)"]}),(0,t.jsx)(v,{rooms:y,onDeleteRoom:e=>x(r.id,e)})]}),s===r.id?(0,t.jsx)(w,{onAddRoom:e=>{f(r.id,e,r.capacity),a(null)},maxCapacity:j}):(0,t.jsxs)(l.z,{variant:"outline",className:"w-full mt-4",onClick:()=>a(r.id),disabled:j<=0,children:[(0,t.jsx)(c.Z,{className:"h-4 w-4 mr-2"}),"Agregar Habitaci\xf3n"]})]})]})}function E(e){let{icon:r,title:s,description:a}=e;return(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center text-center",children:[(0,t.jsx)("div",{className:"flex h-20 w-20 items-center justify-center rounded-full bg-gray-100",children:r}),(0,t.jsx)("h3",{className:"mt-4 text-lg font-semibold text-gray-900",children:s}),(0,t.jsx)("p",{className:"mt-2 text-sm text-gray-500",children:a})]})}var S=s(7332),_=s(875),z=s(2135),L=s(401),I=s(6474);let O=S.fC;S.ZA;let C=S.B4,R=n.forwardRef((e,r)=>{let{className:s,children:a,...n}=e;return(0,t.jsxs)(S.xz,{ref:r,className:(0,I.cn)("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...n,children:[a,(0,t.jsx)(S.JO,{asChild:!0,children:(0,t.jsx)(_.Z,{className:"h-4 w-4 opacity-50"})})]})});R.displayName=S.xz.displayName;let Z=n.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)(S.u_,{ref:r,className:(0,I.cn)("flex cursor-default items-center justify-center py-1",s),...a,children:(0,t.jsx)(z.Z,{className:"h-4 w-4"})})});Z.displayName=S.u_.displayName;let H=n.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)(S.$G,{ref:r,className:(0,I.cn)("flex cursor-default items-center justify-center py-1",s),...a,children:(0,t.jsx)(_.Z,{className:"h-4 w-4"})})});H.displayName=S.$G.displayName;let P=n.forwardRef((e,r)=>{let{className:s,children:a,position:n="popper",...i}=e;return(0,t.jsx)(S.h_,{children:(0,t.jsxs)(S.VY,{ref:r,className:(0,I.cn)("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===n&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:n,...i,children:[(0,t.jsx)(Z,{}),(0,t.jsx)(S.l_,{className:(0,I.cn)("p-1","popper"===n&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:a}),(0,t.jsx)(H,{})]})})});P.displayName=S.VY.displayName,n.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)(S.__,{ref:r,className:(0,I.cn)("px-2 py-1.5 text-sm font-semibold",s),...a})}).displayName=S.__.displayName;let k=n.forwardRef((e,r)=>{let{className:s,children:a,...n}=e;return(0,t.jsxs)(S.ck,{ref:r,className:(0,I.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...n,children:[(0,t.jsx)("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,t.jsx)(S.wU,{children:(0,t.jsx)(L.Z,{className:"h-4 w-4"})})}),(0,t.jsx)(S.eT,{children:a})]})});k.displayName=S.ck.displayName,n.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)(S.Z0,{ref:r,className:(0,I.cn)("-mx-1 my-1 h-px bg-muted",s),...a})}).displayName=S.Z0.displayName;let D=(0,s(535).j)("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function M(e){let{className:r,variant:s,...a}=e;return(0,t.jsx)("div",{className:(0,I.cn)(D({variant:s}),r),...a})}var q=s(1817),U=s(2489),J=s(6557),F=s(8460);function T(){let e=(0,n.useRef)(!1),[r,s]=(0,n.useState)(!1),[a,c]=(0,n.useState)({}),d=(0,J.Z)(e=>e.selectedPartner),u=(0,i.K)(e=>e.selectedDate),g=(0,n.useMemo)(()=>u?new Date(u).toISOString().split("T")[0]:"",[u]),h=(0,m._)(e=>e.hostels),p=(0,m._)(e=>e.isLoading);(0,m._)(e=>e.fetchHostels);let[x,y]=(0,n.useState)(""),v=(0,F.m)(e=>e.fetchPartnerAssignments),b=(0,F.m)(e=>e.fetchAllAssignments),w=(0,F.m)(e=>e.addHostelAssignment),j=(0,F.m)(e=>e.removeHostelAssignment),N=(0,F.m)(e=>e.isHostelAssigned);(0,F.m)(e=>e.getPartnerForHostel);let A=(0,F.m)(e=>e.isLoading),E=(0,F.m)(e=>e.partnerAssignments),S=(0,F.m)(e=>e.allAssignments),_=(0,n.useMemo)(()=>(null==d?void 0:d.id)&&g&&E["".concat(d.id,"-").concat(g)]||[],[E,null==d?void 0:d.id,g]),z=(0,n.useMemo)(()=>g&&S[g]||[],[S,g]);(0,n.useEffect)(()=>{y("")},[null==d?void 0:d.id]),(0,n.useEffect)(()=>{g&&e.current!==g&&(async()=>{try{await b(g),(null==d?void 0:d.id)&&await v(d.id,g),e.current=g}catch(e){console.error("Error fetching assignments:",e)}})()},[g,null==d?void 0:d.id,b,v]),(0,n.useMemo)(()=>_.map(e=>e.hostel_id),[_]);let I=(0,n.useMemo)(()=>z.reduce((e,r)=>{var s,t;let a=r.partner_id,n=null===(s=r.partner)||void 0===s?void 0:s.name,i=(null===(t=r.partner)||void 0===t?void 0:t.size)||0;return a===(null==d?void 0:d.id)?(n=n||d.name,i=i||d.size||0):n=n||"Partner desconocido",e[a]||(e[a]={name:n,size:i,assignments:[]}),e[a].assignments.push(r),e},{}),[z,d]),Z=(0,n.useMemo)(()=>_.length>0||Object.keys(I).length>0,[_,I]);(0,n.useEffect)(()=>{d&&_.length>0&&I[d.id]},[d,_,I]);let H=async()=>{if(!(null==d?void 0:d.id)||!x){f.A.error("Selecciona un albergue para asignar");return}try{s(!0),await w(d.id,x,g),y(""),await b(g),(null==d?void 0:d.id)&&await v(d.id,g)}catch(e){console.error("Error adding hostel:",e),f.A.error("Error al asignar albergue: ".concat(e.message))}finally{s(!1)}},D=async function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{c(r=>({...r,[e]:!0})),await j(e),await b(g),(null==d?void 0:d.id)&&await v(d.id,g)}catch(e){console.error("Error removing hostel:",e),f.A.error("Error al eliminar asignaci\xf3n: ".concat(e.message))}finally{c(r=>{let s={...r};return delete s[e],s})}},T=(0,n.useMemo)(()=>h.filter(e=>!N(e.id,g)),[h,N,g]);if(!d)return null;let B=A&&0===_.length&&0===Object.keys(I).length;return(0,t.jsxs)(o.Zb,{className:"mb-6",children:[(0,t.jsx)(o.Ol,{children:(0,t.jsx)(o.ll,{children:"Asignaci\xf3n de Albergues"})}),(0,t.jsx)(o.aY,{children:B?(0,t.jsxs)("div",{className:"flex items-center justify-center py-4",children:[(0,t.jsx)(q.Z,{className:"w-6 h-6 animate-spin mr-2"}),(0,t.jsx)("span",{children:"Cargando asignaciones..."})]}):(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("div",{className:"grid grid-cols-1 gap-4",children:(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Asignar Nuevo Albergue"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(O,{value:x,onValueChange:y,disabled:r||p,className:"flex-1",children:[(0,t.jsx)(R,{children:(0,t.jsx)(C,{placeholder:"Seleccionar albergue"})}),(0,t.jsx)(P,{children:T.length>0?T.map(e=>(0,t.jsxs)(k,{value:e.id,children:[e.name," (",e.capacity," plazas)"]},e.id)):(0,t.jsx)(k,{value:"none",disabled:!0,children:"No hay albergues disponibles"})})]}),(0,t.jsx)(l.z,{onClick:H,disabled:r||!x||0===T.length,className:"whitespace-nowrap",children:r?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(q.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Asignando..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(L.Z,{className:"mr-2 h-4 w-4"}),"Asignar"]})})]})]})}),(0,t.jsxs)("div",{className:"mt-8",children:[(0,t.jsxs)("h3",{className:"text-sm font-medium mb-3",children:["Todas las asignaciones de hoy (",g,"):"]}),Object.keys(I).length>0?(0,t.jsx)("div",{className:"space-y-4",children:Object.entries(I).map(e=>{let[r,s]=e;return(0,t.jsxs)("div",{className:"border rounded-md p-3",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,t.jsx)("h4",{className:"text-sm font-medium",children:s.name}),(0,t.jsxs)("span",{className:"text-xs text-muted-foreground bg-secondary px-2 py-1 rounded-full",children:[s.size," personas"]})]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:s.assignments.map(e=>{var r,s;return(0,t.jsxs)(M,{variant:e.partner_id===(null==d?void 0:d.id)?"default":"outline",className:"py-1 px-2 flex items-center gap-1",children:[(0,t.jsx)("span",{children:(null===(r=e.hostel)||void 0===r?void 0:r.name)||"Desconocido"}),(0,t.jsxs)("span",{className:"text-xs bg-background text-foreground px-1.5 py-0.5 rounded-full ml-1",children:[(null===(s=e.hostel)||void 0===s?void 0:s.capacity)||"?"," plazas"]}),(0,t.jsx)(l.z,{variant:"ghost",size:"icon",className:"h-4 w-4 rounded-full ml-1",onClick:()=>D(e.id,e.partner_id===(null==d?void 0:d.id)),disabled:a[e.id],children:a[e.id]?(0,t.jsx)(q.Z,{className:"h-3 w-3 animate-spin"}):(0,t.jsx)(U.Z,{className:"h-3 w-3"})})]},e.id)})})]},r)})}):(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:Z?"Sincronizando asignaciones...":"No hay asignaciones de albergues hoy"})]})]})})]})}function B(){let[e,r]=(0,n.useState)(null),s=(0,i.K)(e=>e.selectedDate),g=(0,J.Z)(e=>e.selectedPartner);(0,m._)(e=>e.isLoading);let h=(0,m._)(e=>e.hostels),f=(0,m._)(e=>e.error),p=(0,m._)(e=>e.fetchHostels);return((0,n.useEffect)(()=>{p()},[p]),f)?(0,t.jsx)("div",{className:"flex h-full",children:(0,t.jsxs)("div",{className:"p-8 flex-1 flex justify-center text-red-500",children:["Error al cargar albergues: ",f]})}):(0,t.jsx)(a.i,{children:(0,t.jsx)("div",{className:"flex h-full",children:(0,t.jsxs)("div",{className:"flex-1 p-8 overflow-auto flex flex-col gap-8",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,t.jsx)("h1",{className:"text-4xl font-bold",children:"Albergues"}),(0,t.jsxs)(l.z,{className:"bg-fuchsia-pink-500 hover:bg-fuchsia-pink-600",children:[(0,t.jsx)(c.Z,{className:"h-4 w-4 mr-2"}),(0,t.jsx)("a",{href:"/albergues/new",children:"Nuevo Albergue"})]})]}),g?(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(T,{})}):(0,t.jsxs)("div",{className:"p-8 bg-muted/20 rounded-lg flex flex-col items-center justify-center",children:[(0,t.jsx)(d.Z,{className:"h-12 w-12 text-muted-foreground mb-4"}),(0,t.jsx)("h2",{className:"text-2xl font-medium text-gray-700",children:"No hay grupo seleccionado"}),(0,t.jsx)("p",{className:"text-gray-500 mt-2",children:"Selecciona o crea un grupo para asignar albergues"})]}),(0,t.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"Todos los Albergues"}),0===h.length?(0,t.jsx)(o.Zb,{className:"p-12",children:(0,t.jsx)(E,{icon:(0,t.jsx)(u.Z,{className:"w-12 h-12 text-gray-400"}),title:"No hay albergues disponibles",description:"Comienza creando tu primer albergue para gestionar habitaciones y asignaciones.",action:(0,t.jsx)(l.z,{asChild:!0,className:"bg-fuchsia-pink-500 hover:bg-fuchsia-pink-600",children:(0,t.jsxs)("a",{href:"/albergues/new",children:[(0,t.jsx)(c.Z,{className:"h-4 w-4 mr-2"}),"Crear Albergue"]})})})}):(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:h.map(a=>(0,t.jsx)(A,{hostel:a,activeHostelId:e,setActiveHostelId:r,date:s},a.id))})]})})})}},9507:function(e,r,s){"use strict";s.d(r,{i:function(){return i}});var t=s(2265),a=s(9376),n=s(8688);function i(e){let{children:r}=e,{user:s,loading:i,isAuthenticated:o,init:l,refreshSession:c}=(0,n.t)(),[d,u]=(0,t.useState)(!1),m=(0,a.useRouter)();return((0,t.useEffect)(()=>{let e;return(async()=>{try{e=await l(),u(!0)}catch(e){console.error("Failed to initialize auth:",e);try{await c()}catch(e){console.error("Failed to refresh session:",e),m.push("/login")}}})(),()=>{e&&e.unsubscribe()}},[l,c,m]),(0,t.useEffect)(()=>{!d||i||o||m.push("/login")},[o,i,m,d]),i||!o)?null:r}},4449:function(e,r,s){"use strict";s.d(r,{z:function(){return c}});var t=s(7437),a=s(2265),n=s(7495),i=s(535),o=s(6474);let l=(0,i.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"bg-transparent hover:bg-accent hover:text-accent-foreground transition-colors",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-8 w-8 p-0 flex items-center justify-center"}},defaultVariants:{variant:"default",size:"default"}}),c=a.forwardRef((e,r)=>{let{className:s,variant:a,size:i,asChild:c=!1,...d}=e,u=c?n.g7:"button";return(0,t.jsx)(u,{className:(0,o.cn)(l({variant:a,size:i,className:s})),ref:r,...d})});c.displayName="Button"},3583:function(e,r,s){"use strict";s.d(r,{Ol:function(){return o},SZ:function(){return c},Zb:function(){return i},aY:function(){return d},eW:function(){return u},ll:function(){return l}});var t=s(7437),a=s(2265),n=s(6474);let i=a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)("div",{ref:r,className:(0,n.cn)("rounded-xl border bg-card text-card-foreground shadow",s),...a})});i.displayName="Card";let o=a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)("div",{ref:r,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",s),...a})});o.displayName="CardHeader";let l=a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)("div",{ref:r,className:(0,n.cn)("font-semibold leading-none tracking-tight",s),...a})});l.displayName="CardTitle";let c=a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)("div",{ref:r,className:(0,n.cn)("text-sm text-muted-foreground",s),...a})});c.displayName="CardDescription";let d=a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)("div",{ref:r,className:(0,n.cn)("p-6 pt-0",s),...a})});d.displayName="CardContent";let u=a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)("div",{ref:r,className:(0,n.cn)("flex items-center p-6 pt-0",s),...a})});u.displayName="CardFooter"},322:function(e,r,s){"use strict";s.d(r,{I:function(){return i}});var t=s(7437),a=s(2265),n=s(6474);let i=a.forwardRef((e,r)=>{let{className:s,type:a,...i}=e;return(0,t.jsx)("input",{type:a,className:(0,n.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:r,...i})});i.displayName="Input"},877:function(e,r,s){"use strict";s.d(r,{O:function(){return t}});let t=(0,s(3777).eI)("https://llwgjoxjuvqmtmlvlqpr.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imxsd2dqb3hqdXZxbXRtbHZscXByIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDA2NzYyOTEsImV4cCI6MjA1NjI1MjI5MX0.0bl222cpSXfbN6v_08NyKQohDta19N4xwdY2s_l628A",{auth:{persistSession:!0,storageKey:"supabase-auth",storage:{getItem:e=>{try{let r=localStorage.getItem(e);return r?JSON.parse(r):null}catch(e){return console.error("Error accessing localStorage:",e),null}},setItem:(e,r)=>{try{localStorage.setItem(e,JSON.stringify(r))}catch(e){console.error("Error writing to localStorage:",e)}},removeItem:e=>{try{localStorage.removeItem(e)}catch(e){console.error("Error removing from localStorage:",e)}}}}})},6474:function(e,r,s){"use strict";s.d(r,{cn:function(){return n}});var t=s(1994),a=s(3335);function n(){for(var e=arguments.length,r=Array(e),s=0;s<e;s++)r[s]=arguments[s];return(0,a.m6)((0,t.W)(r))}},8688:function(e,r,s){"use strict";s.d(r,{t:function(){return l}});var t=s(3011),a=s(877),n=s(6885),i=s(4438);let o=async e=>{if(!e)return null;let{data:r,error:s}=await a.O.from("profiles").select("*").eq("id",e).single();return s?(console.error("Error fetching user profile:",s),null):r},l=(0,t.U)((0,n.tJ)((e,r)=>({user:null,userProfile:null,loading:!0,isAuthenticated:!1,authSubscription:null,init:async()=>{try{e({loading:!0});let s=r().authSubscription;s&&s.unsubscribe();let{data:{session:t},error:n}=await a.O.auth.getSession();if(n)return console.error("Session retrieval error:",n),e({loading:!1,isAuthenticated:!1}),null;let l=null;(null==t?void 0:t.user)&&(l=await o(t.user.id)),e({user:(null==t?void 0:t.user)||null,userProfile:l,isAuthenticated:!!(null==t?void 0:t.user),loading:!1});let{data:{subscription:c}}=a.O.auth.onAuthStateChange(async(r,s)=>{console.log("Auth state change:",r,s?"session exists":"no session");let t=null;(null==s?void 0:s.user)&&(t=await o(s.user.id)),e({user:(null==s?void 0:s.user)||null,userProfile:t,isAuthenticated:!!(null==s?void 0:s.user)}),"SIGNED_IN"===r?i.A.success("Sesi\xf3n iniciada correctamente"):"SIGNED_OUT"===r?i.A.info("Sesi\xf3n cerrada"):"TOKEN_REFRESHED"===r&&console.log("Token refreshed successfully")});return e({authSubscription:c}),c}catch(r){return console.error("Auth initialization error:",r),e({loading:!1,user:null,userProfile:null,isAuthenticated:!1}),null}},refreshSession:async()=>{try{e({loading:!0});let{data:r,error:s}=await a.O.auth.refreshSession();if(s)throw s;let{session:t,user:n}=r,i=null;return n&&(i=await o(n.id)),e({user:n||null,userProfile:i,isAuthenticated:!!n,loading:!1}),{session:t,user:n}}catch(r){throw e({loading:!1}),console.error("Session refresh error:",r),r}},signIn:async r=>{let{email:s,password:t}=r;try{e({loading:!0});let{data:r,error:n}=await a.O.auth.signInWithPassword({email:s,password:t});if(n)throw n;let i=await o(r.user.id);return e({user:r.user,userProfile:i,isAuthenticated:!!r.user,loading:!1}),{user:r.user,profile:i}}catch(r){throw e({loading:!1}),i.A.error("Error: ".concat(r.message)),r}},signUp:async r=>{let{email:s,password:t,userData:n={}}=r;try{var l;e({loading:!0});let{data:r,error:i}=await a.O.auth.signUp({email:s,password:t,options:{data:{...n}}});if(i)throw i;if(r.user&&(null===(l=r.user.identities)||void 0===l?void 0:l.length)===0)return e({loading:!1}),{user:null,requiresEmailConfirmation:!0};let c=await o(r.user.id);return e({user:r.user,userProfile:c,isAuthenticated:!!r.user,loading:!1}),{user:r.user,profile:c,requiresEmailConfirmation:!1}}catch(r){throw e({loading:!1}),i.A.error("Error: ".concat(r.message)),r}},signOut:async()=>{try{e({loading:!0});let{error:r}=await a.O.auth.signOut();if(r)throw r;return e({user:null,userProfile:null,isAuthenticated:!1,loading:!1}),!0}catch(r){throw e({loading:!1}),i.A.error("Error al cerrar sesi\xf3n: ".concat(r.message)),r}}}),{name:"auth-storage",partialize:e=>({user:e.user,userProfile:e.userProfile}),onRehydrateStorage:()=>e=>{e&&e.init()}}))},5170:function(e,r,s){"use strict";s.d(r,{K:function(){return i}});var t=s(3011),a=s(8250),n=s(6885);let i=(0,t.U)((0,n.tJ)(e=>({selectedDate:new Date,dateStr:(0,a.WU)(new Date,"yyyy-MM-dd"),setSelectedDate:r=>{let s=new Date(r);e({selectedDate:s,dateStr:(0,a.WU)(s,"yyyy-MM-dd")})}}),{name:"selected-date-storage",getStorage:()=>localStorage,partialize:e=>({selectedDate:e.selectedDate.toISOString(),dateStr:e.dateStr}),onRehydrateStorage:()=>e=>{if(e&&e.selectedDate){let r=new Date(e.selectedDate);e.selectedDate=r,e.dateStr=(0,a.WU)(r,"yyyy-MM-dd")}}}))},8460:function(e,r,s){"use strict";s.d(r,{m:function(){return i}});var t=s(3011),a=s(877),n=s(4438);let i=(0,t.U)((e,r)=>({partnerAssignments:{},allAssignments:{},isLoading:!1,error:null,fetchPartnerAssignments:async(r,s)=>{if(!r||!s)return[];try{e({isLoading:!0,error:null});let{data:t,error:n}=await a.O.from("hostel_partner_assignments").select("*, hostel:hostels(*)").eq("partner_id",r).eq("date",s);if(n)throw Error("Error fetching assignments: ".concat(n.message));let i="".concat(r,"-").concat(s);return e(e=>({partnerAssignments:{...e.partnerAssignments,[i]:t||[]},isLoading:!1})),t||[]}catch(r){throw console.error("Error in fetchPartnerAssignments:",r),e({error:r.message,isLoading:!1}),r}},fetchAllAssignments:async r=>{if(!r)return[];try{e({isLoading:!0,error:null});let{data:s,error:t}=await a.O.from("hostel_partner_assignments").select("\n          *,\n          hostel:hostels(*),\n          partner:partners(id, name, size)\n        ").eq("date",r);if(t)throw Error("Error fetching all assignments: ".concat(t.message));return e(e=>({allAssignments:{...e.allAssignments,[r]:s||[]},isLoading:!1})),s||[]}catch(r){throw console.error("Error in fetchAllAssignments:",r),e({error:r.message,isLoading:!1}),r}},addHostelAssignment:async(s,t,i)=>{if(!s||!t||!i)throw Error("Partner ID, hostel ID, and date are required");try{let l=(r().allAssignments[i]||[]).find(e=>e.hostel_id===t&&!e.id.toString().startsWith("temp-"));if(l){var o;let e=(null===(o=l.partner)||void 0===o?void 0:o.name)||"otro partner";throw Error("Este albergue ya est\xe1 asignado a ".concat(e," hoy"))}e({isLoading:!0,error:null});let{data:c,error:d}=await a.O.from("hostel_partner_assignments").insert({partner_id:s,hostel_id:t,date:i}).select("*, hostel:hostels(*)").single();if(d)throw Error("Error creating assignment: ".concat(d.message));let u="".concat(s,"-").concat(i);return e(e=>{let r=e.partnerAssignments[u]||[],t={...e.partnerAssignments,[u]:[...r,c]},a=e.allAssignments[i]||[],n={...e.allAssignments,[i]:[...a,{...c,partner:{id:s,name:"Partner actualizado"}}]};return{partnerAssignments:t,allAssignments:n,isLoading:!1}}),n.A.success("Albergue asignado correctamente"),c}catch(r){throw console.error("Error in addHostelAssignment:",r),e({error:r.message,isLoading:!1}),n.A.error("Error al asignar albergue: ".concat(r.message)),r}},removeHostelAssignment:async s=>{try{let t=Object.values(r().allAssignments).flat().find(e=>e.id===s);if(!t)throw Error("Assignment not found");e({isLoading:!0,error:null});let{error:i}=await a.O.from("hostel_partner_assignments").delete().eq("id",s);if(i)throw Error("Error removing assignment: ".concat(i.message));let o=t.partner_id,l=t.date,c="".concat(o,"-").concat(l);return e(e=>{let r={...e.partnerAssignments};r[c]&&(r[c]=r[c].filter(e=>e.id!==s));let t={...e.allAssignments};return t[l]&&(t[l]=t[l].filter(e=>e.id!==s)),{partnerAssignments:r,allAssignments:t,isLoading:!1}}),n.A.success("Asignaci\xf3n eliminada correctamente"),{id:s}}catch(r){throw console.error("Error in removeHostelAssignment:",r),e({error:r.message,isLoading:!1}),n.A.error("Error al eliminar asignaci\xf3n: ".concat(r.message)),r}},getPartnerAssignments:(e,s)=>{if(!e||!s)return[];let t="".concat(e,"-").concat(s);return r().partnerAssignments[t]||[]},isHostelAssigned:(e,s)=>(r().allAssignments[s]||[]).some(r=>r.hostel_id===e),getPartnerForHostel:(e,s)=>{var t;return(null===(t=(r().allAssignments[s]||[]).find(r=>r.hostel_id===e))||void 0===t?void 0:t.partner)||null},resetError:()=>e({error:null})}))},9279:function(e,r,s){"use strict";s.d(r,{_:function(){return d}});var t=s(3011),a=s(4438);s(3079);var n=s(2119),i=(0,n.$)("f55caeec1617cf79b9f2eb056e11463b8cbb4a02"),o=(0,n.$)("229fa677a20f148a8603de39dd9331cee94983bf"),l=(0,n.$)("037b7e861bc6ea420d66cf150cb69da0c518156f"),c=(0,n.$)("6dd04356cf656044f11609b065047b9f93a65df9");let d=(0,t.U)((e,r)=>({hostels:[],isLoading:!1,error:null,fetchHostels:async()=>{try{e({isLoading:!0,error:null});let r=await o();if(r.error)throw Error(r.error);return e({hostels:r.hostels||[],isLoading:!1}),r.hostels||[]}catch(r){throw console.error("Error in fetchHostels:",r),e({error:r.message,isLoading:!1}),a.A.error("Error al cargar albergues: ".concat(r.message)),r}},addHostel:async r=>{try{e({isLoading:!0,error:null});let s=await l(r);if(s.error)throw Error(s.error);return e(e=>({hostels:[...e.hostels,s.hostel],isLoading:!1})),a.A.success('Albergue "'.concat(r.name,'" creado correctamente')),s.hostel}catch(r){throw console.error("Error in addHostel:",r),e({error:r.message,isLoading:!1}),a.A.error("Error al crear albergue: ".concat(r.message)),r}},updateHostel:async(r,s)=>{try{e({isLoading:!0,error:null});let t=await c(r,s);if(t.error)throw Error(t.error);return e(e=>({hostels:e.hostels.map(e=>e.id===r?t.hostel:e),isLoading:!1})),a.A.success("Albergue actualizado correctamente"),t.hostel}catch(r){throw console.error("Error in updateHostel:",r),e({error:r.message,isLoading:!1}),a.A.error("Error al actualizar albergue: ".concat(r.message)),r}},deleteHostel:async s=>{try{e({isLoading:!0,error:null});let t=r().hostels.find(e=>e.id===s);if(!t)throw Error("Hostel not found");let n=await i(s);if(n.error)throw Error(n.error);return e(e=>({hostels:e.hostels.filter(e=>e.id!==s),isLoading:!1})),a.A.success('Albergue "'.concat(t.name,'" eliminado correctamente')),{id:s}}catch(r){throw console.error("Error in deleteHostel:",r),e({error:r.message,isLoading:!1}),a.A.error("Error al eliminar albergue: ".concat(r.message)),r}},getHostelById:e=>r().hostels.find(r=>r.id===e)||null,resetError:()=>e({error:null})}))},6557:function(e,r,s){"use strict";s.d(r,{Z:function(){return n}});var t=s(3011);s(4438);var a=s(6885);let n=(0,t.U)((0,a.tJ)((e,r)=>({selectedPartner:null,groups:[],individuals:[],hostelAssignments:[],setSelectedPartner:r=>{if(!r){e({selectedPartner:null,groups:[],individuals:[]});return}e({selectedPartner:r,groups:r.groups||[],individuals:r.individuals||[]}),window.dispatchEvent(new CustomEvent("partner-changed",{detail:{partner:r}}))},setGroups:r=>e({groups:r}),setIndividuals:r=>e({individuals:r}),setHostelAssignments:r=>e({hostelAssignments:r})}),{name:"partner-storage",getStorage:()=>localStorage,partialize:e=>({selectedPartner:e.selectedPartner,groups:e.groups,individuals:e.individuals,hostelAssignments:e.hostelAssignments}),onRehydrateStorage:()=>e=>{e&&(console.log("Partner store rehydrated from storage"),e.selectedPartner&&window.dispatchEvent(new CustomEvent("partner-changed",{detail:{partner:e.selectedPartner}})))}}))}},function(e){e.O(0,[172,863,241,807,98,971,117,744],function(){return e(e.s=7584)}),_N_E=e.O()}]);