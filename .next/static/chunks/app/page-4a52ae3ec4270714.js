(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{892:function(e,r,s){Promise.resolve().then(s.bind(s,8468))},8468:function(e,r,s){"use strict";s.r(r),s.d(r,{default:function(){return H}});var t=s(7437),n=s(9507),i=s(3583),a=s(5005),o=s(8420),l=s(4449),d=s(4438),c=s(8250),u=s(2265),m=s(795),g=s(4314),p=s(6557),f=s(5170);s(522);var h=s(9279),x=s(3011),y=s(877);let v=(0,x.U)((e,r)=>({assignments:{},isLoading:!1,error:null,fetchAssignmentsByDate:async(r,s)=>{if(!r)return[];let t=(0,c.WU)(new Date(r),"yyyy-MM-dd");try{e({isLoading:!0,error:null});let{data:r,error:n}=await y.O.from("assignments").select("\n          *,\n          groups!group_id(id, size, partner_id),\n          person!person_id(id, name, partner_id),\n          room:room_id(*)\n        ").eq("date",t);if(n)throw Error("Error fetching assignments: ".concat(n.message));let i=r||[];s&&(i=i.filter(e=>e.group_id&&e.groups?e.groups.partner_id===s:!!e.person_id&&!!e.person&&e.person.partner_id===s));let a=i.map(e=>({id:e.id,roomId:e.room_id,date:e.date,type:e.group_id?"group":"individual",groupId:e.group_id,individualId:e.person_id,entity:e.group_id?e.groups:e.person})),o=s?"".concat(t,"-").concat(s):t;return e(e=>({assignments:{...e.assignments,[o]:a},isLoading:!1})),a}catch(r){throw console.error("Error in fetchAssignmentsByDate:",r),e({error:r.message,isLoading:!1}),r}},createAssignment:async(r,s,t)=>{if(!r||"string"!=typeof r||!r.includes("-"))throw Error("ID inv\xe1lido: debe tener formato 'tipo-id'");let[n,...i]=r.split("-"),a=i.join("-"),o=(0,c.WU)(new Date(t),"yyyy-MM-dd");try{var l;e({isLoading:!0,error:null});let r={room_id:s,date:o,..."group"===n?{group_id:a,person_id:null}:{person_id:a,group_id:null}},{data:t,error:i}=await y.O.from("assignments").insert([r]).select("\n          *,\n          groups!group_id(*),\n          person!person_id(*),\n          room:room_id(*)\n        ").single();if(i)throw Error("Error creating assignment: ".concat(i.message));let d={id:t.id,roomId:t.room_id,date:t.date,type:t.group_id?"group":"individual",groupId:t.group_id,individualId:t.person_id,entity:t.group_id?t.groups:t.person},c=null===(l=d.entity)||void 0===l?void 0:l.partner_id;return e(e=>{let r={...e};for(let e of[c?"".concat(o,"-").concat(c):o,o])r.assignments[e]&&(r.assignments[e]=[...r.assignments[e],d]);return{...r,isLoading:!1}}),d}catch(r){throw console.error("Error in createAssignment:",r),e({error:r.message,isLoading:!1}),d.A.error("Error al crear asignaci\xf3n: ".concat(r.message)),r}},deleteAssignment:async r=>{try{e({isLoading:!0,error:null});let{error:s}=await y.O.from("assignments").delete().eq("id",r);if(s)throw Error("Error deleting assignment: ".concat(s.message));return e(e=>{let s={...e.assignments};return Object.keys(s).forEach(e=>{s[e]=s[e].filter(e=>e.id!==r)}),{assignments:s,isLoading:!1}}),{id:r}}catch(r){throw console.error("Error in deleteAssignment:",r),e({error:r.message,isLoading:!1}),d.A.error("Error al eliminar asignaci\xf3n: ".concat(r.message)),r}},getAssignmentsByDateAndPartner:(e,s)=>{if(!e)return[];let t=(0,c.WU)(new Date(e),"yyyy-MM-dd"),n=s?"".concat(t,"-").concat(s):t;return r().assignments[n]||[]},isEntityAssigned:(e,s,t)=>{if(!t||!e||!s)return!1;let n=(0,c.WU)(new Date(t),"yyyy-MM-dd");return Object.values(r().assignments).flat().filter(e=>e.date===n).some(r=>"group"===s&&r.groupId===e||"individual"===s&&r.individualId===e)},clearAssignments:()=>e({assignments:{}}),resetError:()=>e({error:null})}));var j=s(8460);function b(e){let{children:r,id:s,disabled:n}=e,{attributes:i,listeners:a,setNodeRef:o,transform:l}=(0,m.O1)({id:s,disabled:n}),d=l?{transform:"translate3d(".concat(l.x,"px, ").concat(l.y,"px, 0)")}:void 0;return(0,t.jsx)("div",{ref:o,style:d,...a,...i,className:n?"pointer-events-none":"",children:r})}var w=s(6474);function A(e){let{children:r,id:s,disabled:n}=e,{isOver:i,setNodeRef:a}=(0,m.Zj)({id:s,disabled:n});return(0,t.jsx)("div",{ref:a,className:(0,w.cn)("transition-all duration-200",i&&!n&&"border-primary bg-primary/5",n&&"cursor-not-allowed opacity-60"),children:r})}var N=s(2369);function E(e){let{individuals:r,assignedStatus:s={}}=e,n=e=>s[e.id]||!1,a=r.filter(e=>!n(e));return(0,t.jsxs)(i.Zb,{children:[(0,t.jsx)(i.Ol,{children:(0,t.jsxs)(i.ll,{className:"flex items-center gap-2 text-lg",children:[(0,t.jsx)(N.Z,{className:"h-5 w-5"}),"Personas Disponibles",(0,t.jsxs)("span",{className:"ml-auto text-xs text-muted-foreground",children:[a.length," disponibles"]})]})}),(0,t.jsx)(i.aY,{className:"space-y-2",children:0===a.length?(0,t.jsx)("div",{className:"text-center text-gray-500 py-4",children:"No hay personas disponibles"}):a.map(e=>(0,t.jsx)(b,{id:"individual-".concat(e.id),children:(0,t.jsx)("div",{className:(0,w.cn)("p-3 rounded-lg border border-border transition-colors","bg-card hover:bg-accent cursor-move"),children:(0,t.jsx)("div",{className:"flex justify-between items-center",children:(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:e.name}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:e.notes||""})]})})})},"individual-".concat(e.id)))})]})}s(905);var _=s(5805);function I(e){let{groups:r,assignedStatus:s={}}=e,n=e=>s[e.id]||!1,a=r.filter(e=>!n(e));return(0,t.jsxs)(i.Zb,{children:[(0,t.jsx)(i.Ol,{children:(0,t.jsxs)(i.ll,{className:"flex items-center gap-2 text-lg",children:[(0,t.jsx)(_.Z,{className:"h-5 w-5"}),"Grupos Disponibles",(0,t.jsxs)("span",{className:"ml-auto text-xs text-muted-foreground",children:[a.length," disponibles"]})]})}),(0,t.jsx)(i.aY,{className:"space-y-2",children:0===a.length?(0,t.jsx)("div",{className:"text-center text-muted-foreground py-4",children:"No hay grupos disponibles"}):a.map(e=>{var r;return(0,t.jsx)(b,{id:"group-".concat(e.id),children:(0,t.jsx)("div",{className:(0,w.cn)("p-3 rounded-lg border border-border transition-colors relative","bg-card hover:bg-accent cursor-move"),children:(0,t.jsx)("div",{className:"flex justify-between items-center",children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("p",{children:[e.people.length," personas"]}),(0,t.jsx)("ul",{children:null===(r=e.people)||void 0===r?void 0:r.map(e=>(0,t.jsx)("li",{className:"text-sm text-muted-foreground",children:e.name},e.id))})]})})})},"group-".concat(e.id))})})]})}var L=s(1817),z=s(2489);function C(e){let{hostel:r,assignments:s,removeAssignment:n,entities:i,date:a}=e,o=e=>{if("group"!==e.type||!e.entity)return 1;if(Array.isArray(e.entity.people))return e.entity.people.length;if("number"==typeof e.entity.size)return e.entity.size;if(e.isOptimistic&&e.groupId){var r;let s=null===(r=i.groups)||void 0===r?void 0:r.find(r=>r.id===e.groupId);if(s){if(Array.isArray(s.people))return s.people.length;if("number"==typeof s.size)return s.size}}return 0},d=e=>{let r=s.filter(r=>r.roomId===e.id),t=r.reduce((e,r)=>e+o(r),0);return{current:t,total:e.capacity||0,remaining:(e.capacity||0)-t,assignmentsForRoom:r}};return r.rooms&&0!==r.rooms.length?(0,t.jsx)("div",{className:"grid grid-cols-2 gap-4",children:r.rooms.map(e=>{let{current:r,total:s,remaining:a,assignmentsForRoom:c}=d(e),u=a<=0;return(0,t.jsx)(A,{id:e.id,disabled:u,children:(0,t.jsxs)("div",{className:(0,w.cn)("p-4 rounded-lg border-2 min-h-[120px] transition-colors",u&&"bg-gray-100 border-gray-300",c.length>0&&!u&&"border-primary bg-secondary/20",!c.length&&"border-border hover:border-primary/50"),children:[(0,t.jsx)("div",{className:"flex justify-between items-start mb-2",children:(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm font-medium",children:e.name}),(0,t.jsxs)("p",{className:(0,w.cn)("text-xs",u?"text-red-500 font-medium":"text-muted-foreground"),children:[r,"/",s," personas",u&&" (Lleno)"]})]})}),(0,t.jsx)("div",{className:"space-y-2",children:c.map(e=>{var r;let s=o(e);return(0,t.jsx)("div",{children:(0,t.jsxs)("div",{className:(0,w.cn)("flex justify-between items-center",e.isOptimistic&&"border border-dashed border-primary"),children:[(0,t.jsxs)("div",{className:"overflow-hidden",children:[(0,t.jsxs)("p",{className:"font-medium flex items-center",children:[(0,t.jsx)("span",{className:"truncate",children:null===(r=e.entity)||void 0===r?void 0:r.name}),(0,t.jsx)("span",{className:(0,w.cn)("ml-2 text-xs italic min-w-16 inline-block transition-opacity duration-300",e.isOptimistic?"opacity-100 text-primary":"opacity-0"),children:"(asignando...)"})]}),"group"===e.type&&(()=>{var r;let s=null===(r=i.groups)||void 0===r?void 0:r.find(r=>r.id===e.groupId);return s&&Array.isArray(s.people)&&s.people.length>0?(0,t.jsx)("div",{className:"text-xs flex flex-col gap-1",children:s.people.map((e,r)=>(0,t.jsx)("span",{children:"object"==typeof e?e.name:e},"object"==typeof e&&e.id||r))}):null})(),(0,t.jsx)("p",{className:"text-sm text-muted-foreground truncate",children:"group"===e.type?"".concat(s," personas"):"Individual"})]}),(0,t.jsx)("div",{className:"w-8 h-8 flex items-center justify-center",children:e.isOptimistic?(0,t.jsx)(L.Z,{className:"h-4 w-4 animate-spin text-muted-foreground"}):(0,t.jsx)(l.z,{variant:"ghost",size:"icon",className:"h-8 w-8 p-0",onClick:()=>n(e.id),children:(0,t.jsx)(z.Z,{className:"h-4 w-4"})})})]})},e.id)})}),!u&&a>0&&(0,t.jsxs)("p",{className:"text-xs text-muted-foreground mt-2",children:["Espacio disponible: ",a," personas"]})]})},e.id)})}):(0,t.jsx)("div",{className:"text-center p-4 text-muted-foreground",children:"Este albergue no tiene habitaciones"})}s(3487);var O=s(2735),S=s(4457),D=s.n(S);function M(e){let{hostel:r,assignments:s,date:n,entities:i,checkedEntities:a}=e,[o,m]=(0,u.useState)(!1),[g,p]=(0,u.useState)(!1),{groups:f,individuals:h}=i||{},x=async()=>{if(!r.rooms.some(e=>s.some(r=>r.roomId===e.id))){d.A.info("No hay habitaciones con asignaciones para descargar");return}m(!0),p(!0);try{await new Promise(e=>setTimeout(e,300));let e=document.getElementById("consolidated-hostel-view");if(!e)throw Error("No se pudo generar la vista consolidada");let s=(await D()(e,{backgroundColor:"#ffffff",scale:2,logging:!1,useCORS:!0,onclone:e=>{let r=e.getElementById("consolidated-hostel-view");r&&(r.style.position="absolute",r.style.left="0",r.style.top="0",r.style.opacity="1",r.style.pointerEvents="none",r.style.zIndex="-1",r.style.width="850px")}})).toDataURL("image/png"),t=document.createElement("a");t.href=s,t.download="".concat(r.name,"-Asignaciones-").concat((0,c.WU)(n,"yyyy-MM-dd"),".png").replace(/\s+/g,"-"),t.click()}catch(e){console.error("Error al generar la imagen consolidada:",e)}finally{p(!1),m(!1)}},y={};return Array.isArray(f)&&f.forEach(e=>{y[e.id]={...e,type:"group",people:Array.isArray(e.people)?[...e.people]:[]}}),Array.isArray(h)&&h.forEach(e=>{y[e.id]={...e,type:"individual"}}),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"flex gap-2",children:(0,t.jsx)(l.z,{variant:"outline",size:"sm",className:"flex items-center gap-1",onClick:x,disabled:o,children:o?(0,t.jsx)(L.Z,{className:"h-4 w-4 animate-spin"}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(O.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"text-xs",children:"Descargar Asignaciones"})]})})}),g&&(0,t.jsx)("div",{style:{position:"fixed",left:"-9999px",top:0},children:(0,t.jsxs)("div",{id:"consolidated-hostel-view",style:{backgroundColor:"white",padding:"20px",width:"850px",fontFamily:"Arial, sans-serif"},children:[(0,t.jsxs)("h1",{style:{textAlign:"center",fontSize:"24px",paddingBottom:"12px",borderBottom:"2px solid #000",display:"flex",justifyContent:"center",flexWrap:"wrap",gap:"20px"},children:[r.name," - ",(0,c.WU)(n,"dd/MM/yyyy")]}),r.rooms.filter(e=>s.some(r=>r.roomId===e.id)).map(e=>{let r=s.filter(r=>r.roomId===e.id);return(0,t.jsxs)("div",{style:{borderRadius:"5px",padding:"10px",justifyContent:"center",display:"inline"},children:[(0,t.jsxs)("h2",{style:{fontSize:"18px",marginBottom:"10px",padding:"5px",borderRadius:"3px",textAlign:"center"},children:["Habitaci\xf3n de ",e.capacity," personas"]}),(0,t.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",justifyContent:"center",gap:"12px"},children:[r.map(e=>{let r=e.entityId||e.groupId||e.individualId,s=y[r];return s?(0,t.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:"12px"},children:"group"===s.type&&Array.isArray(s.people)&&s.people.length>0&&(0,t.jsx)("div",{style:{borderRadius:"12px",padding:"12px",display:"inline"},children:s.people.map((e,s)=>(0,t.jsxs)("div",{style:{marginBottom:"4px",color:"#555",fontSize:"14px",fontStyle:"italic",textAlign:"center"},children:[e.name," ",e.lastName||"",e.age&&" (".concat(e.age," a\xf1os)")]},"person-".concat(r,"-").concat(s)))})},"entity-".concat(e.id)):(0,t.jsx)("div",{style:{marginBottom:"4px",fontSize:"14px",fontStyle:"italic",color:"#555"},children:"(datos no disponibles)"},"person-".concat(e.id))}),0===r.length&&(0,t.jsx)("div",{style:{fontStyle:"italic",color:"#666"},children:"Sin ocupantes"})]})]},"consolidated-".concat(e.id))})]})})]})}function H(){let e=(0,f.K)(e=>e.selectedDate);(0,f.K)(e=>e.setSelectedDate);let[r,s]=(0,u.useState)({groups:{},individuals:{}}),l=(0,m.Dy)((0,m.VT)(m.we)),{selectedPartner:x,groups:y,individuals:b}=(0,p.Z)(),{hostels:w,isLoading:A,fetchHostels:N}=(0,h._)(),{isLoading:_,fetchAssignmentsByDate:L,createAssignment:z,deleteAssignment:O,addOptimisticAssignment:S,updateOptimisticAssignment:D}=v(),{fetchPartnerAssignments:H,isLoading:Z}=(0,j.m)(),k=(null==x?void 0:x.id)&&e?v.getState().getAssignmentsByDateAndPartner(e,x.id):[],R=e?(0,c.WU)(e,"yyyy-MM-dd"):"",U=((null==x?void 0:x.id)&&R?j.m.getState().getPartnerAssignments(x.id,R):[]).map(e=>e.hostel_id),W=(null==x?void 0:x.id)&&0!==U.length?w.filter(e=>U.includes(e.id)):[];(0,u.useEffect)(()=>{N()},[N]),(0,u.useEffect)(()=>{if((null==x?void 0:x.id)&&e){let r=(0,c.WU)(e,"yyyy-MM-dd");L(e,x.id),H(x.id,r),s({groups:{},individuals:{}})}},[e,null==x?void 0:x.id,L,H]);let B={...r.groups},P={...r.individuals};for(let e of k)"group"===e.type&&e.groupId?B[e.groupId]=!0:"individual"===e.type&&e.individualId&&(P[e.individualId]=!0);let q={groups:B,individuals:P};(0,c.WU)(e,"yyyy-MM-dd");let F=(0,u.useCallback)((e,r)=>{let[s,...t]=e.split("-"),n=t.join("-");if("group"!==s)return{hasCapacity:!0};let i=y.find(e=>e.id===n),a=w.flatMap(e=>e.rooms||[]).find(e=>e.id===r);if(!i||!a)return console.error("Group or room not found:",{groupId:n,roomId:r}),{hasCapacity:!1,error:"Grupo o habitaci\xf3n no encontrados"};let o=a.capacity||0,l=0;k.filter(e=>e.roomId===r).forEach(e=>{var r;"group"===e.type&&(null===(r=e.entity)||void 0===r?void 0:r.size)?l+=parseInt(e.entity.size)||0:"individual"===e.type&&(l+=1)});let d=o-l;return{hasCapacity:d>=(parseInt(i.size)||0),remainingCapacity:d,requestedSpace:i.size,roomCapacity:o}},[y,w,k]),Y=async r=>{let{active:t,over:n}=r;if(!n){d.A.error("Suelta el grupo en una habitaci\xf3n v\xe1lida");return}try{let[r,...i]=t.id.split("-"),a=i.join("-");if("group"===r&&q.groups[a]||"individual"===r&&q.individuals[a]){d.A.error("Este ".concat("group"===r?"grupo":"individuo"," ya est\xe1 asignado a una habitaci\xf3n"));return}if("group"===r){let e=F(t.id,n.id);if(!e.hasCapacity){d.A.error("No hay espacio suficiente en la habitaci\xf3n",{description:"Capacidad disponible: ".concat(e.remainingCapacity,"/").concat(e.roomCapacity,". Tama\xf1o del grupo: ").concat(e.requestedSpace)});return}}let o="group"===r?y.find(e=>e.id===a):b.find(e=>e.id===a),l=w.flatMap(e=>e.rooms||[]).find(e=>e.id===n.id);if(!o||!l)throw Error("No se pudo encontrar la entidad o la habitaci\xf3n");s(e=>"group"===r?{...e,groups:{...e.groups,[a]:!0}}:{...e,individuals:{...e.individuals,[a]:!0}}),await z(t.id,n.id,e),await L(e,x.id)}catch(a){let[r,...n]=t.id.split("-"),i=n.join("-");s(e=>"group"===r?{...e,groups:{...e.groups,[i]:!1}}:{...e,individuals:{...e.individuals,[i]:!1}}),d.A.error("Error al crear asignaci\xf3n: ".concat(a.message),{id:"assignment-progress"}),L(e,null==x?void 0:x.id),console.error("Error completo:",a)}},T={};if(!_&&k.length){let e=new Map;k.forEach(r=>{r.roomId&&(e.has(r.id)||(e.set(r.id,!0),T[r.roomId]||(T[r.roomId]=[]),T[r.roomId].push(r)))})}let V=async e=>{try{let r=k.find(r=>r.id===e);if(!r){console.error("Assignment not found:",e);return}await O(e),"group"===r.type&&r.groupId?s(e=>({...e,groups:{...e.groups,[r.groupId]:!1}})):"individual"===r.type&&r.individualId&&s(e=>({...e,individuals:{...e.individuals,[r.individualId]:!1}}))}catch(e){console.error("Error removing assignment:",e),d.A.error("Error al eliminar la asignaci\xf3n")}},$=async(e,r)=>{try{await V(e)}catch(e){console.error("Error al eliminar asignaci\xf3n:",e)}};return x?(0,t.jsx)(n.i,{children:(0,t.jsx)("div",{className:"min-h-screen bg-background",children:(0,t.jsxs)("div",{className:"p-8",children:[(0,t.jsxs)("h1",{className:"text-4xl font-bold text-primary mb-8",children:["Asignaci\xf3n de Viajeros - ",x.name]}),(0,t.jsx)(m.LB,{sensors:l,collisionDetection:m.ey,onDragEnd:Y,onDragOver:e=>{let{active:r,over:s}=e;if(!s)return;let[t,...n]=r.id.split("-");"group"===t&&F(r.id,s.id)},modifiers:[g.hg],children:(0,t.jsxs)("div",{className:"flex gap-8",children:[(0,t.jsxs)("div",{className:"w-1/4 space-y-6",children:[(0,t.jsx)(I,{groups:y,assignedStatus:q.groups}),(0,t.jsx)(E,{individuals:b,assignedStatus:q.individuals})]}),(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsx)("div",{className:"space-y-6",children:W.length>0?W.map(r=>(0,t.jsxs)(i.Zb,{children:[(0,t.jsxs)(i.Ol,{className:"flex flex-row items-center justify-between",children:[(0,t.jsxs)(i.ll,{className:"flex items-center gap-2 text-lg",children:[(0,t.jsx)(o.Z,{className:"h-5 w-5"}),r.name]}),(0,t.jsx)(M,{hostel:r,assignments:k,checkedEntities:q,date:e,entities:{groups:y,individuals:b}})]}),(0,t.jsx)(i.aY,{children:(0,t.jsx)(C,{hostel:r,assignments:k,roomAssignments:T,removeAssignment:V,forceRemoval:$,entities:{groups:y,individuals:b},date:e})})]},r.id)):(0,t.jsx)(i.Zb,{children:(0,t.jsxs)(i.aY,{className:"flex flex-col items-center justify-center py-10",children:[(0,t.jsx)(o.Z,{className:"h-12 w-12 text-muted-foreground mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-medium text-center",children:"No hay albergues asignados a este grupo"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground text-center mt-1",children:"Usa la secci\xf3n “Asignaci\xf3n de Albergues” para asignar albergues a este grupo"})]})})})})]})})]})})}):(0,t.jsx)(n.i,{children:(0,t.jsxs)("div",{className:"p-8 flex flex-col items-center justify-center h-[60vh]",children:[(0,t.jsx)(a.Z,{className:"h-16 w-16 text-gray-400 mb-4"}),(0,t.jsx)("h2",{className:"text-2xl font-medium text-gray-700",children:"No hay grupo seleccionado"}),(0,t.jsx)("p",{className:"text-gray-500 mt-2",children:"Selecciona o crea un grupo para gestionar asignaciones"})]})})}},9507:function(e,r,s){"use strict";s.d(r,{i:function(){return a}});var t=s(2265),n=s(9376),i=s(8688);function a(e){let{children:r}=e,{user:s,loading:a,isAuthenticated:o,init:l,refreshSession:d}=(0,i.t)(),[c,u]=(0,t.useState)(!1),m=(0,n.useRouter)();return((0,t.useEffect)(()=>{let e;return(async()=>{try{e=await l(),u(!0)}catch(e){console.error("Failed to initialize auth:",e);try{await d()}catch(e){console.error("Failed to refresh session:",e),m.push("/login")}}})(),()=>{e&&e.unsubscribe()}},[l,d,m]),(0,t.useEffect)(()=>{!c||a||o||m.push("/login")},[o,a,m,c]),a||!o)?null:r}},3583:function(e,r,s){"use strict";s.d(r,{Ol:function(){return o},SZ:function(){return d},Zb:function(){return a},aY:function(){return c},eW:function(){return u},ll:function(){return l}});var t=s(7437),n=s(2265),i=s(6474);let a=n.forwardRef((e,r)=>{let{className:s,...n}=e;return(0,t.jsx)("div",{ref:r,className:(0,i.cn)("rounded-xl border bg-card text-card-foreground shadow",s),...n})});a.displayName="Card";let o=n.forwardRef((e,r)=>{let{className:s,...n}=e;return(0,t.jsx)("div",{ref:r,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",s),...n})});o.displayName="CardHeader";let l=n.forwardRef((e,r)=>{let{className:s,...n}=e;return(0,t.jsx)("div",{ref:r,className:(0,i.cn)("font-semibold leading-none tracking-tight",s),...n})});l.displayName="CardTitle";let d=n.forwardRef((e,r)=>{let{className:s,...n}=e;return(0,t.jsx)("div",{ref:r,className:(0,i.cn)("text-sm text-muted-foreground",s),...n})});d.displayName="CardDescription";let c=n.forwardRef((e,r)=>{let{className:s,...n}=e;return(0,t.jsx)("div",{ref:r,className:(0,i.cn)("p-6 pt-0",s),...n})});c.displayName="CardContent";let u=n.forwardRef((e,r)=>{let{className:s,...n}=e;return(0,t.jsx)("div",{ref:r,className:(0,i.cn)("flex items-center p-6 pt-0",s),...n})});u.displayName="CardFooter"},3487:function(e,r,s){"use strict";s.d(r,{TooltipProvider:function(){return o},u:function(){return m}});var t=s(7437),n=s(2265),i=s(1312),a=s(6474);let o=i.zt,l=i.fC,d=i.xz,c=i.h_,u=n.forwardRef((e,r)=>{let{className:s,sideOffset:n=4,...o}=e;return(0,t.jsx)(i.VY,{ref:r,sideOffset:n,className:(0,a.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...o})});u.displayName=i.VY.displayName;let m=e=>{let{children:r,content:s,className:n,delayDuration:i=300,...a}=e;return(0,t.jsxs)(l,{delayDuration:i,children:[(0,t.jsx)(d,{asChild:!0,children:r}),(0,t.jsx)(c,{children:(0,t.jsx)(u,{className:n,...a,children:s})})]})}},8460:function(e,r,s){"use strict";s.d(r,{m:function(){return a}});var t=s(3011),n=s(877),i=s(4438);let a=(0,t.U)((e,r)=>({partnerAssignments:{},allAssignments:{},isLoading:!1,error:null,fetchPartnerAssignments:async(r,s)=>{if(!r||!s)return[];try{e({isLoading:!0,error:null});let{data:t,error:i}=await n.O.from("hostel_partner_assignments").select("*, hostel:hostels(*)").eq("partner_id",r).eq("date",s);if(i)throw Error("Error fetching assignments: ".concat(i.message));let a="".concat(r,"-").concat(s);return e(e=>({partnerAssignments:{...e.partnerAssignments,[a]:t||[]},isLoading:!1})),t||[]}catch(r){throw console.error("Error in fetchPartnerAssignments:",r),e({error:r.message,isLoading:!1}),r}},fetchAllAssignments:async r=>{if(!r)return[];try{e({isLoading:!0,error:null});let{data:s,error:t}=await n.O.from("hostel_partner_assignments").select("\n          *,\n          hostel:hostels(*),\n          partner:partners(id, name, size)\n        ").eq("date",r);if(t)throw Error("Error fetching all assignments: ".concat(t.message));return e(e=>({allAssignments:{...e.allAssignments,[r]:s||[]},isLoading:!1})),s||[]}catch(r){throw console.error("Error in fetchAllAssignments:",r),e({error:r.message,isLoading:!1}),r}},addHostelAssignment:async(s,t,a)=>{if(!s||!t||!a)throw Error("Partner ID, hostel ID, and date are required");try{let l=(r().allAssignments[a]||[]).find(e=>e.hostel_id===t&&!e.id.toString().startsWith("temp-"));if(l){var o;let e=(null===(o=l.partner)||void 0===o?void 0:o.name)||"otro partner";throw Error("Este albergue ya est\xe1 asignado a ".concat(e," hoy"))}e({isLoading:!0,error:null});let{data:d,error:c}=await n.O.from("hostel_partner_assignments").insert({partner_id:s,hostel_id:t,date:a}).select("*, hostel:hostels(*)").single();if(c)throw Error("Error creating assignment: ".concat(c.message));let u="".concat(s,"-").concat(a);return e(e=>{let r=e.partnerAssignments[u]||[],t={...e.partnerAssignments,[u]:[...r,d]},n=e.allAssignments[a]||[],i={...e.allAssignments,[a]:[...n,{...d,partner:{id:s,name:"Partner actualizado"}}]};return{partnerAssignments:t,allAssignments:i,isLoading:!1}}),i.A.success("Albergue asignado correctamente"),d}catch(r){throw console.error("Error in addHostelAssignment:",r),e({error:r.message,isLoading:!1}),i.A.error("Error al asignar albergue: ".concat(r.message)),r}},removeHostelAssignment:async s=>{try{let t=Object.values(r().allAssignments).flat().find(e=>e.id===s);if(!t)throw Error("Assignment not found");e({isLoading:!0,error:null});let{error:a}=await n.O.from("hostel_partner_assignments").delete().eq("id",s);if(a)throw Error("Error removing assignment: ".concat(a.message));let o=t.partner_id,l=t.date,d="".concat(o,"-").concat(l);return e(e=>{let r={...e.partnerAssignments};r[d]&&(r[d]=r[d].filter(e=>e.id!==s));let t={...e.allAssignments};return t[l]&&(t[l]=t[l].filter(e=>e.id!==s)),{partnerAssignments:r,allAssignments:t,isLoading:!1}}),i.A.success("Asignaci\xf3n eliminada correctamente"),{id:s}}catch(r){throw console.error("Error in removeHostelAssignment:",r),e({error:r.message,isLoading:!1}),i.A.error("Error al eliminar asignaci\xf3n: ".concat(r.message)),r}},getPartnerAssignments:(e,s)=>{if(!e||!s)return[];let t="".concat(e,"-").concat(s);return r().partnerAssignments[t]||[]},isHostelAssigned:(e,s)=>(r().allAssignments[s]||[]).some(r=>r.hostel_id===e),getPartnerForHostel:(e,s)=>{var t;return(null===(t=(r().allAssignments[s]||[]).find(r=>r.hostel_id===e))||void 0===t?void 0:t.partner)||null},resetError:()=>e({error:null})}))},9279:function(e,r,s){"use strict";s.d(r,{_:function(){return c}});var t=s(3011),n=s(4438);s(3079);var i=s(2119),a=(0,i.$)("f55caeec1617cf79b9f2eb056e11463b8cbb4a02"),o=(0,i.$)("229fa677a20f148a8603de39dd9331cee94983bf"),l=(0,i.$)("037b7e861bc6ea420d66cf150cb69da0c518156f"),d=(0,i.$)("6dd04356cf656044f11609b065047b9f93a65df9");let c=(0,t.U)((e,r)=>({hostels:[],isLoading:!1,error:null,fetchHostels:async()=>{try{e({isLoading:!0,error:null});let r=await o();if(r.error)throw Error(r.error);return e({hostels:r.hostels||[],isLoading:!1}),r.hostels||[]}catch(r){throw console.error("Error in fetchHostels:",r),e({error:r.message,isLoading:!1}),n.A.error("Error al cargar albergues: ".concat(r.message)),r}},addHostel:async r=>{try{e({isLoading:!0,error:null});let s=await l(r);if(s.error)throw Error(s.error);return e(e=>({hostels:[...e.hostels,s.hostel],isLoading:!1})),n.A.success('Albergue "'.concat(r.name,'" creado correctamente')),s.hostel}catch(r){throw console.error("Error in addHostel:",r),e({error:r.message,isLoading:!1}),n.A.error("Error al crear albergue: ".concat(r.message)),r}},updateHostel:async(r,s)=>{try{e({isLoading:!0,error:null});let t=await d(r,s);if(t.error)throw Error(t.error);return e(e=>({hostels:e.hostels.map(e=>e.id===r?t.hostel:e),isLoading:!1})),n.A.success("Albergue actualizado correctamente"),t.hostel}catch(r){throw console.error("Error in updateHostel:",r),e({error:r.message,isLoading:!1}),n.A.error("Error al actualizar albergue: ".concat(r.message)),r}},deleteHostel:async s=>{try{e({isLoading:!0,error:null});let t=r().hostels.find(e=>e.id===s);if(!t)throw Error("Hostel not found");let i=await a(s);if(i.error)throw Error(i.error);return e(e=>({hostels:e.hostels.filter(e=>e.id!==s),isLoading:!1})),n.A.success('Albergue "'.concat(t.name,'" eliminado correctamente')),{id:s}}catch(r){throw console.error("Error in deleteHostel:",r),e({error:r.message,isLoading:!1}),n.A.error("Error al eliminar albergue: ".concat(r.message)),r}},getHostelById:e=>r().hostels.find(r=>r.id===e)||null,resetError:()=>e({error:null})}))}},function(e){e.O(0,[337,172,863,241,845,664,611,971,117,744],function(){return e(e.s=892)}),_N_E=e.O()}]);